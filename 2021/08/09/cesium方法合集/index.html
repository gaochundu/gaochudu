<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>cesium方法合集 | GIS技术部门</title>

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="/js/swiper/swiper@5.4.1.min.css" rel="stylesheet">
  
  
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    
        <script src="/js/valine/index.js"></script>
    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 5.4.0"></head>

  
  <!-- 依赖于jquery和vue -->
  
    
<script src="https://unpkg.com/jquery@3.5.1/dist/jquery.min.js"></script>

  

  
    
<script src="https://unpkg.com/vue@2.6.11/dist/vue.min.js"></script>

  
  
  <body>
    <!-- 预加载动画 -->
    <!-- 页面预加载动画 -->

<div id='loader'>
  <link rel="stylesheet" href="/js/loaded/index.css" >
  <div class="loading-left-bg"></div>
  <div class="loading-right-bg"></div>
  <div class="spinner-box">
    <div class="configure-border-1">
      <div class="configure-core"></div>
    </div>
    <div class="configure-border-2">
      <div class="configure-core"></div>
    </div>
    <div class="loading-word">加载中...</div>
  </div>
</div>

<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
  
</script>

    
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 需要在上面加载的js -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (src) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- 轮播图所需要的js -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>

<script type="text/javascript">
  Vue.use(window.VueAwesomeSwiper)
</script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="https://unpkg.com/typed.js@2.0.11"></script>


    <div id="safearea">
      <main class="main" id="pjax-container">
        <!-- 头部导航 -->
        
<header class="header   " 
  id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo lazyload placeholder" src="/medias/gis-logo.jpg" class="lazyload placeholder" data-srcset="/medias/gis-logo.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="logo">
      <h3 class="drawer-box-head_title">GIS技术部门</h3>
      <h5 class="drawer-box-head_desc"></h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/" class="drawer-menu-item-link">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">首页</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/archives" class="drawer-menu-item-link">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/tags" class="drawer-menu-item-link">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">标签</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/categories" class="drawer-menu-item-link">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">分类</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/about" class="drawer-menu-item-link">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">关于</span>
                </a>
              
            </li>
          
        
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="/medias/gis-logo.jpg" class="lazyload placeholder" data-srcset="/medias/gis-logo.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="logo">
        </div>
      
      <a href="/" class="logo">GIS技术部门</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/" class="menu-item-link" title="首页">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">首页</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/archives" class="menu-item-link" title="归档">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/tags" class="menu-item-link" title="标签">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">标签</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/categories" class="menu-item-link" title="分类">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">分类</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/about" class="menu-item-link" title="关于">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">关于</span>
                </a>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">本地搜索</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="请输入关键字"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
      window.addEventListener('pjax:complete', () => {
        this.cancelDialogVisible();
      })
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
  
    <div id="he-plugin-simple"></div>
    <script>
      WIDGET = {
        CONFIG: {
          "modules": "012",
          "background": 5,
          "tmpColor": "4A4A4A",
          "tmpSize": 16,
          "cityColor": "4A4A4A",
          "citySize": 16,
          "aqiSize": 16,
          "weatherIconSize": 24,
          "alertIconSize": 18,
          "padding": "10px 10px 10px 10px",
          "shadow": "1",
          "language": "auto",
          "borderRadius": 5,
          "fixed": "false",
          "vertical": "middle",
          "horizontal": "center",
          "key": "2784dd3fcb1e4f0f9a9b579bf69641f2"
        }
      }
    </script>
    <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script> 
    
</header>
        <!-- 内容区域 -->
        
 <!-- prismjs 代码高亮 -->
 
    
    <link href="/js/prism/prism-line-numbers.css" rel="stylesheet">
    
        <link href="/js/prism/prism.min.css" rel="stylesheet">
    

    <style>
        pre[class*="language-"] {
            overflow-y: hidden;
        }
        .line-numbers .line-numbers-rows {
            border: none;
        }
    </style>
  


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>


  <!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('/medias/1.jpg')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        cesium方法合集
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> 发表于：2021-08-09 |
        </span>
      

      
        <span class="post-detail-header_categories">
          <i class="iconfont iconbookmark1"></i> 分类：
          
            <a href="/categories/%E5%89%8D%E7%AB%AF/" class="post-detail-header_category">
              前端
            </a>
          
            <a href="/categories/%E5%89%8D%E7%AB%AF/GIS/" class="post-detail-header_category">
              GIS
            </a>
          
            <a href="/categories/%E5%89%8D%E7%AB%AF/GIS/webGIS/" class="post-detail-header_category">
              webGIS
            </a>
          
        </span>
      

      
    
  </div>
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>





<div class="post-detail-content post-row" 
  style="padding-top: 0px;">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <h1 id="cesium-坐标简述"><a href="#cesium-坐标简述" class="headerlink" title="cesium 坐标简述"></a>cesium 坐标简述</h1><h2 id="1、常用坐标转换API"><a href="#1、常用坐标转换API" class="headerlink" title="1、常用坐标转换API"></a>1、常用坐标转换API</h2><table>
<thead>
<tr>
<th>API</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Cesium.Cartographic.fromCartesian(cartesian, ellipsoid, result)</td>
<td>笛卡尔转弧度</td>
</tr>
<tr>
<td>Cesium.Cartographic.fromDegrees(longitude, latitude, height, result)</td>
<td>经纬度转弧度(度单位)</td>
</tr>
<tr>
<td>Cesium.CesiumMath.toDegrees(radians)</td>
<td>弧度转度</td>
</tr>
<tr>
<td>Cesium.CesiumMath.toRadians(degrees)</td>
<td>度转弧度</td>
</tr>
<tr>
<td>Cesium.Cartographic.fromRadians(longitude, latitude, height, result)</td>
<td>经纬度转弧度(弧度单位)</td>
</tr>
<tr>
<td>Cesium.Cartographic.toCartesian(cartographic, ellipsoid, result)</td>
<td>弧度转笛卡尔</td>
</tr>
<tr>
<td>var pick1= scene.globe.pick(viewer.camera.getPickRay(pt1), scene) //其中pt1为一个二维屏幕坐标</td>
<td>平面坐标转三维坐标(其实都是笛卡尔坐标)</td>
</tr>
<tr>
<td>var geoPt1= scene.globe.ellipsoid.cartesianToCartographic(pick1) //其中pick1是一个Cesium.Cartesian3对象</td>
<td>笛卡尔三维坐标转地理坐标</td>
</tr>
<tr>
<td>var point1=[geoPt1.longitude / Math.PI * 180,geoPt1.latitude / Math.PI * 180]; //其中geoPt1是一个地理坐标</td>
<td>地理坐标转经纬度</td>
</tr>
<tr>
<td>var cartographic = Cesium.Cartographic.fromDegree(point) //point是经纬度值</td>
<td>经纬度转地理坐标(弧度)</td>
</tr>
<tr>
<td>var coord_wgs84 = Cesium.Cartographic.fromDegrees(lng, lat, alt);//单位：度，度，米</td>
<td>经纬度转地理坐标</td>
</tr>
<tr>
<td>var cartesian = Cesium.Cartesian3.fromDegree(point)</td>
<td>经纬度转笛卡尔坐标</td>
</tr>
</tbody></table>
<h2 id="2、笛卡尔坐标系api"><a href="#2、笛卡尔坐标系api" class="headerlink" title="2、笛卡尔坐标系api"></a>2、笛卡尔坐标系api</h2><table>
<thead>
<tr>
<th>API</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Cesium.Cartesian3.abs(cartesian, result)</td>
<td>计算绝对值</td>
</tr>
<tr>
<td>Cesium.Cartesian3.add(left, right, result)</td>
<td>计算两个笛卡尔的分量和</td>
</tr>
<tr>
<td>Cesium.Cartesian3.angleBetween(left, right)</td>
<td>计算角度(弧度制)</td>
</tr>
<tr>
<td>Cesium.Cartesian3.cross(left, right, result)</td>
<td>计算叉积</td>
</tr>
<tr>
<td>Cesium.Cartesian3.distance(left, right)</td>
<td>计算两点距离</td>
</tr>
<tr>
<td>Cesium.Cartesian3.distanceSquared(left, right)</td>
<td>计算两点平方距离</td>
</tr>
<tr>
<td>Cesium.Cartesian3.divideByScalar(cartesian, scalar, result)</td>
<td>计算标量除法</td>
</tr>
<tr>
<td>Cesium.Cartesian3.divideComponents(left, right, result)</td>
<td>计算两点除法</td>
</tr>
<tr>
<td>Cesium.Cartesian3.dot(left, right)    计算点乘</td>
<td></td>
</tr>
<tr>
<td>Cesium.Cartesian3.equals(left, right)</td>
<td>比较两点是否相等</td>
</tr>
<tr>
<td>Cesium.Cartesian3.fromArray(array, startingIndex, result)</td>
<td>从数组中提取3个数构建笛卡尔坐标</td>
</tr>
<tr>
<td>Cesium.Cartesian3.fromDegrees(longitude, latitude, height, ellipsoid, result)</td>
<td>将将纬度转换为笛卡尔坐标(单位是度°)</td>
</tr>
<tr>
<td>Cesium.Cartesian3.fromDegreesArray(coordinates, ellipsoid, result)</td>
<td>返回给定经度和纬度值数组（以度为单位）的笛卡尔位置数组。</td>
</tr>
<tr>
<td>Cesium.Cartesian3.fromDegreesArrayHeights(coordinates, ellipsoid, result)</td>
<td>返回给定经度,纬度和高度的笛卡尔位置数组</td>
</tr>
<tr>
<td>Cesium.Cartesian3.fromElements(x, y, z, result)</td>
<td>创建一个新的笛卡尔坐标</td>
</tr>
<tr>
<td>Cesium.Cartesian3.fromRadians(longitude, latitude, height, ellipsoid, result)</td>
<td>返回笛卡尔坐标以弧度制的经纬度</td>
</tr>
<tr>
<td>Cesium.Cartesian3.fromRadiansArray(coordinates, ellipsoid, result)</td>
<td>返回笛卡尔坐标以弧度制的经纬度数组</td>
</tr>
<tr>
<td>Cesium.Cartesian3.fromRadiansArrayHeights(coordinates, ellipsoid, result)</td>
<td>返回笛卡尔坐标以弧度制的经纬度高度数组</td>
</tr>
<tr>
<td>Cesium.Cartesian3.fromSpherical(spherical, result)</td>
<td>将提供的球面转换为笛卡尔系</td>
</tr>
<tr>
<td>Cesium.Cartesian3.lerp(start, end, t, result)</td>
<td>使用提供的笛卡尔数来计算t处的线性插值或外推。</td>
</tr>
<tr>
<td>Cesium.Cartesian3.magnitude(cartesian)</td>
<td>计算笛卡尔长度</td>
</tr>
<tr>
<td>Cesium.Cartesian3.magnitudeSquared(cartesian)</td>
<td>计算提供的笛卡尔平方量级</td>
</tr>
<tr>
<td>Cesium.Cartesian3.maximumByComponent(first, second, result)</td>
<td>比较两个笛卡尔并计算包含所提供笛卡尔最大成分的笛卡尔。</td>
</tr>
<tr>
<td>Cesium.Cartesian3.maximumComponent(cartesian)</td>
<td>计算所提供笛卡尔坐标系的最大分量的值</td>
</tr>
<tr>
<td>Cesium.Cartesian3.midpoint(left, right, result)</td>
<td>计算右笛卡尔和左笛卡尔之间的中点</td>
</tr>
<tr>
<td>Cesium.Cartesian3.minimumByComponent(first, second, result)</td>
<td>比较两个笛卡尔并计算包含所提供笛卡尔的最小分量的笛卡尔</td>
</tr>
<tr>
<td>Cesium.Cartesian3.minimumComponent(cartesian)</td>
<td>计算所提供笛卡尔坐标系的最小分量的值</td>
</tr>
<tr>
<td>Cesium.Cartesian3.mostOrthogonalAxis(cartesian, result)</td>
<td>返回与提供的笛卡尔坐标最正交的轴</td>
</tr>
<tr>
<td>Cesium.Cartesian3.multiplyByScalar(cartesian, scalar, result)</td>
<td>将提供的笛卡尔分量乘以提供的标量</td>
</tr>
<tr>
<td>Cesium.Cartesian3.multiplyComponents(left, right, result)</td>
<td>计算两个笛卡尔的分量积</td>
</tr>
<tr>
<td>Cesium.Cartesian3.normalize(cartesian, result)</td>
<td>计算所提供笛卡尔的规范化形式</td>
</tr>
<tr>
<td>Cesium.Cartesian3.pack(value, array, startingIndex)</td>
<td>将提供的实例存储到提供的数组中</td>
</tr>
<tr>
<td>Cesium.Cartesian3.projectVector(a, b, result)</td>
<td>将向量a投影到向量b上</td>
</tr>
<tr>
<td>Cesium.Cartesian3.subtract(left, right, result)</td>
<td>计算两个笛卡尔分量差</td>
</tr>
<tr>
<td>Cesium.Cartesian3.unpack(array, startingIndex, result)</td>
<td>从压缩的数组中检索实例</td>
</tr>
<tr>
<td>Cesium.Cartesian3.unpackArray(array, result)</td>
<td>将笛卡尔分量数组解包为笛卡尔数组</td>
</tr>
</tbody></table>
<h1 id="cesium-代码应用"><a href="#cesium-代码应用" class="headerlink" title="cesium 代码应用"></a>cesium 代码应用</h1><h2 id="1、获取三位场景下的相机位置"><a href="#1、获取三位场景下的相机位置" class="headerlink" title="1、获取三位场景下的相机位置"></a>1、获取三位场景下的相机位置</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">getMapCameraInfo</span><span class="token punctuation">(</span><span class="token parameter">cesiumScene</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">//相机姿态</span>
  <span class="token keyword">var</span> d <span class="token operator">=</span> cesiumScene<span class="token punctuation">.</span>camera<span class="token punctuation">;</span>
  <span class="token keyword">var</span> heading <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>heading<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> pitch <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>pitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> roll <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>roll<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> cesiumScene<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>positionCartographic<span class="token punctuation">;</span>
  <span class="token keyword">let</span> lat <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> lng <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    heading<span class="token operator">:</span> heading<span class="token punctuation">,</span>
    pitch<span class="token operator">:</span> pitch<span class="token punctuation">,</span>
    roll<span class="token operator">:</span> roll<span class="token punctuation">,</span>
    lng<span class="token operator">:</span> lng<span class="token punctuation">,</span>
    lat<span class="token operator">:</span> lat<span class="token punctuation">,</span>
    height<span class="token operator">:</span> i<span class="token punctuation">.</span>height
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2、地图左键点击事件"><a href="#2、地图左键点击事件" class="headerlink" title="2、地图左键点击事件"></a>2、地图左键点击事件</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js">mapFunction<span class="token punctuation">.</span>leftClick <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>ScreenSpaceEventHandler</span><span class="token punctuation">(</span>
        cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>canvas
      <span class="token punctuation">)</span>
mapFunction<span class="token punctuation">.</span>leftClick<span class="token punctuation">.</span><span class="token function">setInputAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">click</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> pick <span class="token operator">=</span> cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span>click<span class="token punctuation">.</span>position<span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_CLICK</span><span class="token punctuation">)</span>

<span class="token comment">//=======================================</span>
  <span class="token comment">// 地图事件</span>
  <span class="token function">mapEvent</span> <span class="token punctuation">(</span><span class="token parameter">cesiumView<span class="token punctuation">,</span> config</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    mapEvent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>ScreenSpaceEventHandler</span><span class="token punctuation">(</span>cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mapEvent<span class="token punctuation">.</span><span class="token function">setInputAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">click</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// let pos = getScale(click.endPosition);</span>
      <span class="token comment">// var pick = cesiumView.scene.pick(new Cesium.Cartesian2(pos.x, pos.y));</span>
      <span class="token keyword">var</span> pick <span class="token operator">=</span> cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span>click<span class="token punctuation">.</span>endPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pick <span class="token operator">&amp;&amp;</span> pick<span class="token punctuation">.</span>id <span class="token operator">&amp;&amp;</span> pick<span class="token punctuation">.</span>id<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token string">"cursor: pointer;"</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token string">"cursor: default;"</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">MOUSE_MOVE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mapEvent<span class="token punctuation">.</span><span class="token function">setInputAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">click</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// let pos = getScale(click.position);</span>
      <span class="token comment">// var pick = cesiumView.scene.pick(new Cesium.Cartesian2(pos.x, pos.y));</span>
      <span class="token keyword">var</span> pick <span class="token operator">=</span> cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span>click<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pick <span class="token operator">&amp;&amp;</span> pick<span class="token punctuation">.</span>id <span class="token operator">&amp;&amp;</span> pick<span class="token punctuation">.</span>id<span class="token punctuation">.</span>extendedData <span class="token operator">&amp;&amp;</span> pick<span class="token punctuation">.</span>id<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pick<span class="token punctuation">.</span>id<span class="token punctuation">.</span>extendedData<span class="token punctuation">)</span>
        <span class="token keyword">let</span> extendedData <span class="token operator">=</span> pick<span class="token punctuation">.</span>id<span class="token punctuation">.</span>extendedData<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clickChangePointIcon</span><span class="token punctuation">(</span>pick<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 展示数据框</span>
        <span class="token comment">// $('#mapInfoBox').show()</span>
        <span class="token comment">// this.setInfoPosition(cesiumView, extendedData.lng, extendedData.lat)</span>
        <span class="token comment">// this.setHtmlDataText(extendedData, config)</span>
        <span class="token comment">// this.clickState = true</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"none"</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_CLICK</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-移除鼠标事件"><a href="#1-移除鼠标事件" class="headerlink" title="1.移除鼠标事件"></a>1.移除鼠标事件</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//方式一</span>
handler<span class="token punctuation">.</span><span class="token function">removeInputAction</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_CLICK</span><span class="token punctuation">)</span><span class="token comment">//移除事件</span>
 
<span class="token comment">//方式二</span>
 viewer<span class="token punctuation">.</span>screenSpaceEventHandler<span class="token punctuation">.</span><span class="token function">removeInputAction</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_CLICK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-事件类型"><a href="#2-事件类型" class="headerlink" title="2.事件类型"></a>2.事件类型</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js">

Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_CLICK</span> <span class="token comment">//鼠标左击事件</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_DOUBLE_CLICK</span> <span class="token comment">//鼠标左键双击事件</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_DOWN</span> <span class="token comment">//左键鼠标按下事件</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_UP</span> <span class="token comment">//左键鼠标抬起事件</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">MIDDLE_CLICK</span> <span class="token comment">//中键单机</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">MIDDLE_DOWN</span> <span class="token comment">//中键按下</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">MIDDLE_UP</span> <span class="token comment">//中键抬起</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">MOUSE_MOVE</span> <span class="token comment">//鼠标移动</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">PINCH_END</span> <span class="token comment">//表示两指事件在触摸面上的结束。</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">PINCH_MOVE</span> <span class="token comment">//两指移动</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">PINCH_START</span> <span class="token comment">//表示在触摸面上发生两指事件的开始。</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">RIGHT_CLICK</span> <span class="token comment">//鼠标右击事件</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">RIGHT_DOWN</span>  <span class="token comment">//鼠标右键按下</span>
Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">RIGHT_UP</span>    <span class="token comment">//鼠标右键抬起s</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="3、设置地图视角"><a href="#3、设置地图视角" class="headerlink" title="3、设置地图视角"></a>3、设置地图视角</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">mapFlyTo</span> <span class="token punctuation">(</span><span class="token parameter">style</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">let</span> initialPosition <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span>
       style<span class="token punctuation">.</span>lng<span class="token punctuation">,</span>
       style<span class="token punctuation">.</span>lat<span class="token punctuation">,</span>
       style<span class="token punctuation">.</span>height
     <span class="token punctuation">)</span>
     <span class="token keyword">let</span> initialOrientation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>HeadingPitchRoll<span class="token punctuation">.</span>fromDegrees</span><span class="token punctuation">(</span>
       style<span class="token punctuation">.</span>heading<span class="token punctuation">,</span>
       style<span class="token punctuation">.</span>pitch<span class="token punctuation">,</span>
       style<span class="token punctuation">.</span>roll
     <span class="token punctuation">)</span> <span class="token comment">//初始化相机对准方向1：左右摆动角度；2：上下俯仰角度；3：相机翻滚角度</span>
     cesiumScene<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">setView</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
       destination<span class="token operator">:</span> initialPosition<span class="token punctuation">,</span>
       orientation<span class="token operator">:</span> initialOrientation<span class="token punctuation">,</span>
       endTransform<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Matrix4<span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">,</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4、创建线的材质样式"><a href="#4、创建线的材质样式" class="headerlink" title="4、创建线的材质样式"></a>4、创建线的材质样式</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"> <span class="token comment">// 构建管线贴片</span>
<span class="token function">loadGXStyle</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> color<span class="token punctuation">,</span> Speed</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> duration</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_definitionChanged <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Event</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_color <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_colorSubscription <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color
    <span class="token keyword">this</span><span class="token punctuation">.</span>duration <span class="token operator">=</span> duration
    <span class="token keyword">this</span><span class="token punctuation">.</span>_time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token class-name">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    isConstant<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    definitionChanged<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_definitionChanged
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> Cesium<span class="token punctuation">.</span><span class="token function">createPropertyDescriptor</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token class-name">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getType</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'PolylineTrailLink'</span>
  <span class="token punctuation">&#125;</span>
  <span class="token class-name">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
    <span class="token parameter">time<span class="token punctuation">,</span>
    result</span>
  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Cesium<span class="token punctuation">.</span><span class="token function">defined</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    result<span class="token punctuation">.</span>color <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Property<span class="token punctuation">.</span><span class="token function">getValueOrClonedDefault</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_color<span class="token punctuation">,</span>
      time<span class="token punctuation">,</span>
      Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">WHITE</span><span class="token punctuation">,</span>
      result<span class="token punctuation">.</span>color
    <span class="token punctuation">)</span>
    result<span class="token punctuation">.</span>image <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkImage
    result<span class="token punctuation">.</span>time <span class="token operator">=</span>
      <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_time<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>duration
    <span class="token keyword">return</span> result
  <span class="token punctuation">&#125;</span>
  <span class="token class-name">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">equals</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span> <span class="token operator">===</span> other <span class="token operator">||</span>
      <span class="token punctuation">(</span>other <span class="token keyword">instanceof</span> <span class="token class-name">PolylineTrailLinkMaterialProperty</span> <span class="token operator">&amp;&amp;</span>
        Property<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_color<span class="token punctuation">,</span> other<span class="token punctuation">.</span>_color<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  Cesium<span class="token punctuation">.</span>PolylineTrailLinkMaterialProperty <span class="token operator">=</span> PolylineTrailLinkMaterialProperty
  Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkType <span class="token operator">=</span> <span class="token string">'PolylineTrailLink'</span>
  Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkImage <span class="token operator">=</span> url
  Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkSource <span class="token operator">=</span>
    <span class="token string">'czm_material czm_getMaterial(czm_materialInput materialInput)\n\
            &#123;\n\
            czm_material material = czm_getDefaultMaterial(materialInput);\n\
            vec2 st = materialInput.st;\n\
            vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n\
            material.alpha = colorImage.a * color.a;\n\
            material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n\
            return material;\n\
            &#125;'</span>
  Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>_materialCache<span class="token punctuation">.</span><span class="token function">addMaterial</span><span class="token punctuation">(</span>
    Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkType<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      fabric<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        type<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkType<span class="token punctuation">,</span>
        uniforms<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          color<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          image<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkImage<span class="token punctuation">,</span>
          time<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        source<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkSource<span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token function-variable function">translucent</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">material</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">var</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolylineTrailLinkMaterialProperty</span><span class="token punctuation">(</span>
    color<span class="token punctuation">,</span>
    Speed <span class="token operator">||</span> <span class="token number">10000</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>material<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="5、实线和虚线"><a href="#5、实线和虚线" class="headerlink" title="5、实线和虚线"></a>5、实线和虚线</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//正常线</span>
 <span class="token keyword">var</span> scene <span class="token operator">=</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">;</span>
 <span class="token keyword">var</span> primitive <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Primitive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
 	geometryInstances<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>GeometryInstance</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    	geometry<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolylineGeometry</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        	positions<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegreesArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">120.0</span><span class="token punctuation">,</span><span class="token number">40.0</span><span class="token punctuation">,</span><span class="token number">100.0</span><span class="token punctuation">,</span><span class="token number">30.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            width<span class="token operator">:</span><span class="token number">3.0</span><span class="token punctuation">,</span>
            vertexFormat<span class="token operator">:</span>Cesium<span class="token punctuation">.</span>PolylineColorAppearance<span class="token punctuation">.</span><span class="token constant">VERTEX_FORMAT</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        	color<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>ColorGeometryInstanceAttribute<span class="token punctuation">.</span><span class="token function">fromColor</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">RED</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    appearance<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolylineColorAppearance</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    	translucent<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">//是否透明</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>primitive<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//虚线</span>
<span class="token keyword">var</span> primitive1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Primitive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
 	geometryInstances<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>GeometryInstance</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    	geometry<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolylineGeometry</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        	positions<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegreesArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">110.0</span><span class="token punctuation">,</span><span class="token number">50.0</span><span class="token punctuation">,</span><span class="token number">120.0</span><span class="token punctuation">,</span><span class="token number">60.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            width<span class="token operator">:</span><span class="token number">3.0</span><span class="token punctuation">,</span>
            vertexFormat<span class="token operator">:</span>Cesium<span class="token punctuation">.</span>PolylineColorAppearance<span class="token punctuation">.</span><span class="token constant">VERTEX_FORMAT</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    appearance<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolylineMaterialAppearance</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    	material<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span><span class="token function">fromType</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineDashType<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    		color<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">CYAN</span><span class="token punctuation">,</span>  <span class="token comment">//线条颜色</span>
        	gapColor<span class="token operator">:</span>Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">TRANSPARENT</span><span class="token punctuation">,</span> <span class="token comment">//间隔颜色</span>
        	dashLength<span class="token operator">:</span><span class="token number">20</span>  <span class="token comment">//短划线长度</span>
    	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>primitive1<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="6、cesium画贴地线"><a href="#6、cesium画贴地线" class="headerlink" title="6、cesium画贴地线"></a>6、cesium画贴地线</h2><p><strong>1. Entity 实现方式</strong><br>Polyline对象的clampToGround属性设置为true。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">viewer<span class="token punctuation">.</span>entities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    polyline<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        positions<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegreesArray</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">,</span>
        width<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        clampToGround<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//开启贴地</span>
        material<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">RED</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2. Primitive 实现方式</strong><br>需要使用<a target="_blank" rel="noopener" href="https://doc.ttext.cn/cesiumjs/Build/Documentation/GroundPolylinePrimitive.html?classFilter=GroundPolylinePrimitive">GroundPolylinePrimitive</a>和<a target="_blank" rel="noopener" href="https://doc.ttext.cn/cesiumjs/Build/Documentation/GroundPolylineGeometry.html?classFilter=GroundPolylineGeometry">GroundPolylineGeometry</a>来创建Primitive与Geometry对象，而不是使用<a target="_blank" rel="noopener" href="https://doc.ttext.cn/cesiumjs/Build/Documentation/Primitive.html?classFilter=Primitive">Primitive</a>和<a target="_blank" rel="noopener" href="https://doc.ttext.cn/cesiumjs/Build/Documentation/PolylineGeometry.html?classFilter=PolylineGeometry">PolylineGeometry</a>创建Primitive与Geometry对象。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>GroundPolylinePrimitive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    geometryInstances <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>GeometryInstance</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        geometry <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>GroundPolylineGeometry</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            positions <span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegreesArray</span><span class="token punctuation">(</span>positions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            width <span class="token operator">:</span> <span class="token number">15.0</span><span class="token punctuation">,</span><span class="token comment">//线宽</span>
            vertexFormat <span class="token operator">:</span> Cesium<span class="token punctuation">.</span>PolylineColorAppearance<span class="token punctuation">.</span><span class="token constant">VERTEX_FORMAT</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        attributes <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            color <span class="token operator">:</span> Cesium<span class="token punctuation">.</span>ColorGeometryInstanceAttribute<span class="token punctuation">.</span><span class="token function">fromColor</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span>fromCssColorString</span><span class="token punctuation">(</span><span class="token string">"#0096ff"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    appearance <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolylineColorAppearance</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        translucent <span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="7、圆形区域闪烁"><a href="#7、圆形区域闪烁" class="headerlink" title="7、圆形区域闪烁"></a>7、圆形区域闪烁</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">twinkleCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> flog <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    dataSourse<span class="token punctuation">.</span>entities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"圆形区域闪烁"</span><span class="token punctuation">,</span>
        position<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span>pointItem<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pointItem<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ellipse<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            semiMinorAxis<span class="token operator">:</span> <span class="token number">5000.0</span><span class="token punctuation">,</span>
            semiMajorAxis<span class="token operator">:</span> <span class="token number">5000.0</span><span class="token punctuation">,</span>
            height<span class="token operator">:</span> <span class="token number">350</span><span class="token punctuation">,</span>
            heightReference<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>HeightReference<span class="token punctuation">.</span><span class="token constant">RELATIVE_TO_GROUND</span><span class="token punctuation">,</span>
            material<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>ColorMaterialProperty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>CallbackProperty</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>flog<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    x <span class="token operator">=</span> x <span class="token operator">-</span> <span class="token number">0.05</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        flog <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">0.05</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        flog <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">return</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">RED</span><span class="token punctuation">.</span><span class="token function">withAlpha</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">twinkleCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="8、半圆报警扫描"><a href="#8、半圆报警扫描" class="headerlink" title="8、半圆报警扫描"></a>8、半圆报警扫描</h2><p><strong>注意地形遮挡问题：</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>depthTestAgainstTerrain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//控制视角,能被地形遮挡</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 构建报警贴图</span>
   <span class="token comment">// 报警</span>
   <span class="token function-variable function">AddCircleScanPostStage</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
     <span class="token parameter">viewer<span class="token punctuation">,</span>
     cartographicCenter<span class="token punctuation">,</span>
     maxRadius<span class="token punctuation">,</span>
     scanColor<span class="token punctuation">,</span>
     duration</span>
   <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">var</span> ScanSegmentShader <span class="token operator">=</span>
       <span class="token string">"uniform sampler2D colorTexture;\n"</span> <span class="token operator">+</span>
       <span class="token string">"uniform sampler2D depthTexture;\n"</span> <span class="token operator">+</span>
       <span class="token string">"varying vec2 v_textureCoordinates;\n"</span> <span class="token operator">+</span>
       <span class="token string">"uniform vec4 u_scanCenterEC;\n"</span> <span class="token operator">+</span>
       <span class="token string">"uniform vec3 u_scanPlaneNormalEC;\n"</span> <span class="token operator">+</span>
       <span class="token string">"uniform float u_radius;\n"</span> <span class="token operator">+</span>
       <span class="token string">"uniform vec4 u_scanColor;\n"</span> <span class="token operator">+</span>
       <span class="token string">"vec4 toEye(in vec2 uv, in float depth)\n"</span> <span class="token operator">+</span>
       <span class="token string">" &#123;\n"</span> <span class="token operator">+</span>
       <span class="token string">" vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n"</span> <span class="token operator">+</span>
       <span class="token string">" vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n"</span> <span class="token operator">+</span>
       <span class="token string">" posInCamera =posInCamera / posInCamera.w;\n"</span> <span class="token operator">+</span>
       <span class="token string">" return posInCamera;\n"</span> <span class="token operator">+</span>
       <span class="token string">" &#125;\n"</span> <span class="token operator">+</span>
       <span class="token string">"vec3 pointProjectOnPlane(in vec3 planeNormal, in vec3 planeOrigin, in vec3 point)\n"</span> <span class="token operator">+</span>
       <span class="token string">"&#123;\n"</span> <span class="token operator">+</span>
       <span class="token string">"vec3 v01 = point -planeOrigin;\n"</span> <span class="token operator">+</span>
       <span class="token string">"float d = dot(planeNormal, v01) ;\n"</span> <span class="token operator">+</span>
       <span class="token string">"return (point - planeNormal * d);\n"</span> <span class="token operator">+</span>
       <span class="token string">"&#125;\n"</span> <span class="token operator">+</span>
       <span class="token string">"float getDepth(in vec4 depth)\n"</span> <span class="token operator">+</span>
       <span class="token string">"&#123;\n"</span> <span class="token operator">+</span>
       <span class="token string">"float z_window = czm_unpackDepth(depth);\n"</span> <span class="token operator">+</span>
       <span class="token string">"z_window = czm_reverseLogDepth(z_window);\n"</span> <span class="token operator">+</span>
       <span class="token string">"float n_range = czm_depthRange.near;\n"</span> <span class="token operator">+</span>
       <span class="token string">"float f_range = czm_depthRange.far;\n"</span> <span class="token operator">+</span>
       <span class="token string">"return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n"</span> <span class="token operator">+</span>
       <span class="token string">"&#125;\n"</span> <span class="token operator">+</span>
       <span class="token string">"void main()\n"</span> <span class="token operator">+</span>
       <span class="token string">"&#123;\n"</span> <span class="token operator">+</span>
       <span class="token string">"gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n"</span> <span class="token operator">+</span>
       <span class="token string">"float depth = getDepth( texture2D(depthTexture, v_textureCoordinates));\n"</span> <span class="token operator">+</span>
       <span class="token string">"vec4 viewPos = toEye(v_textureCoordinates, depth);\n"</span> <span class="token operator">+</span>
       <span class="token string">"vec3 prjOnPlane = pointProjectOnPlane(u_scanPlaneNormalEC.xyz, u_scanCenterEC.xyz, viewPos.xyz);\n"</span> <span class="token operator">+</span>
       <span class="token string">"float dis = length(prjOnPlane.xyz - u_scanCenterEC.xyz);\n"</span> <span class="token operator">+</span>
       <span class="token string">"if(dis &lt; u_radius)\n"</span> <span class="token operator">+</span>
       <span class="token string">"&#123;\n"</span> <span class="token operator">+</span>
       <span class="token string">"float f = 1.0 -abs(u_radius - dis) / u_radius;\n"</span> <span class="token operator">+</span>
       <span class="token string">"f = pow(f, 4.0);\n"</span> <span class="token operator">+</span>
       <span class="token string">"gl_FragColor = mix(gl_FragColor, u_scanColor, f);\n"</span> <span class="token operator">+</span>
       <span class="token string">"&#125;\n"</span> <span class="token operator">+</span>
       <span class="token string">"&#125;\n"</span><span class="token punctuation">;</span>

     <span class="token keyword">var</span> _Cartesian3Center <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartographic<span class="token punctuation">.</span><span class="token function">toCartesian</span><span class="token punctuation">(</span>
       cartographicCenter
     <span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">var</span> _Cartesian4Center <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian4</span><span class="token punctuation">(</span>
       _Cartesian3Center<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
       _Cartesian3Center<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
       _Cartesian3Center<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
       <span class="token number">1</span>
     <span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">var</span> _CartographicCenter1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartographic</span><span class="token punctuation">(</span>
       cartographicCenter<span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>
       cartographicCenter<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span>
       cartographicCenter<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token number">500</span>
     <span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">var</span> _Cartesian3Center1 <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartographic<span class="token punctuation">.</span><span class="token function">toCartesian</span><span class="token punctuation">(</span>
       _CartographicCenter1
     <span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">var</span> _Cartesian4Center1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian4</span><span class="token punctuation">(</span>
       _Cartesian3Center1<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
       _Cartesian3Center1<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
       _Cartesian3Center1<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
       <span class="token number">1</span>
     <span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">var</span> _time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">var</span> _scratchCartesian4Center <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">var</span> _scratchCartesian4Center1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">var</span> _scratchCartesian3Normal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">let</span> pScanPostStage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PostProcessStage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
       fragmentShader<span class="token operator">:</span> ScanSegmentShader<span class="token punctuation">,</span>
       uniforms<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
         <span class="token function-variable function">u_scanCenterEC</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           <span class="token keyword">return</span> Cesium<span class="token punctuation">.</span>Matrix4<span class="token punctuation">.</span><span class="token function">multiplyByVector</span><span class="token punctuation">(</span>
             viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>_viewMatrix<span class="token punctuation">,</span>
             _Cartesian4Center<span class="token punctuation">,</span>
             _scratchCartesian4Center
           <span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
         <span class="token function-variable function">u_scanPlaneNormalEC</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           <span class="token keyword">var</span> temp <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Matrix4<span class="token punctuation">.</span><span class="token function">multiplyByVector</span><span class="token punctuation">(</span>
             viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>_viewMatrix<span class="token punctuation">,</span>
             _Cartesian4Center<span class="token punctuation">,</span>
             _scratchCartesian4Center
           <span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">var</span> temp1 <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Matrix4<span class="token punctuation">.</span><span class="token function">multiplyByVector</span><span class="token punctuation">(</span>
             viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>_viewMatrix<span class="token punctuation">,</span>
             _Cartesian4Center1<span class="token punctuation">,</span>
             _scratchCartesian4Center1
           <span class="token punctuation">)</span><span class="token punctuation">;</span>
           _scratchCartesian3Normal<span class="token punctuation">.</span>x <span class="token operator">=</span> temp1<span class="token punctuation">.</span>x <span class="token operator">-</span> temp<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
           _scratchCartesian3Normal<span class="token punctuation">.</span>y <span class="token operator">=</span> temp1<span class="token punctuation">.</span>y <span class="token operator">-</span> temp<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
           _scratchCartesian3Normal<span class="token punctuation">.</span>z <span class="token operator">=</span> temp1<span class="token punctuation">.</span>z <span class="token operator">-</span> temp<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
           Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span>
             _scratchCartesian3Normal<span class="token punctuation">,</span>
             _scratchCartesian3Normal
           <span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> _scratchCartesian3Normal<span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
         <span class="token function-variable function">u_radius</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           <span class="token keyword">return</span> <span class="token punctuation">(</span>
             <span class="token punctuation">(</span>maxRadius <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> _time<span class="token punctuation">)</span> <span class="token operator">%</span> duration<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span>
             duration
           <span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
         u_scanColor<span class="token operator">:</span> scanColor<span class="token punctuation">,</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>postProcessStages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pScanPostStage<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">return</span> pScanPostStage<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="9、获取点击地图后的经纬度信息"><a href="#9、获取点击地图后的经纬度信息" class="headerlink" title="9、获取点击地图后的经纬度信息"></a>9、获取点击地图后的经纬度信息</h2><p><strong>方法1</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 获取点击的POI点位</span>
<span class="token comment">// 点击的坐标</span>
<span class="token comment">// var pick = scene.pick(movement.position)</span>
<span class="token keyword">let</span> location <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">pickPosition</span><span class="token punctuation">(</span>movement<span class="token punctuation">.</span>position<span class="token punctuation">)</span>
<span class="token comment">//如果定义了对象，则返回true，否则返回false。</span>
<span class="token keyword">var</span> pickedEntity <span class="token operator">=</span> Cesium<span class="token punctuation">.</span><span class="token function">defined</span><span class="token punctuation">(</span>pick<span class="token punctuation">)</span> <span class="token operator">?</span> pick<span class="token punctuation">.</span>id <span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token comment">//pick.id即为entity</span>
<span class="token keyword">var</span> cartographic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartographic<span class="token punctuation">.</span>fromCartesian</span><span class="token punctuation">(</span>
    location<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid
<span class="token punctuation">)</span>
<span class="token keyword">var</span> lat <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>cartographic<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span>
<span class="token keyword">var</span> lng <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>cartographic<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span>

<span class="token comment">// console.log(pickedEntity)</span>
<span class="token comment">// console.log(pick)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'经度:'</span> <span class="token operator">+</span> lng <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token string">'纬度:'</span> <span class="token operator">+</span> lat<span class="token punctuation">)</span>
<span class="token comment">//获取点击的POI点位END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>方法2</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/*************************右键点击返回经纬度**********************/</span>
<span class="token keyword">var</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>ScreenSpaceEventHandler</span><span class="token punctuation">(</span>cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
handler<span class="token punctuation">.</span><span class="token function">setInputAction</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> earthPosition <span class="token operator">=</span> cesiumView<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">pickEllipsoid</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>position<span class="token punctuation">,</span> cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> cartographic <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartographic<span class="token punctuation">.</span><span class="token function">fromCartesian</span><span class="token punctuation">(</span>earthPosition<span class="token punctuation">,</span> cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartographic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> lat <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>cartographic<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> lng <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>cartographic<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> height <span class="token operator">=</span> cartographic<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lng <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">RIGHT_CLICK</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="10、地图视角飞入，调整地图视角"><a href="#10、地图视角飞入，调整地图视角" class="headerlink" title="10、地图视角飞入，调整地图视角"></a>10、地图视角飞入，调整地图视角</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 视角参数</span>
<span class="token keyword">let</span> configMapSceneStyle <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  lng<span class="token operator">:</span> <span class="token number">108.52866036065753</span><span class="token punctuation">,</span>
  lat<span class="token operator">:</span> <span class="token number">30.293739782135887</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">403217.96718934656</span><span class="token punctuation">,</span>
  heading<span class="token operator">:</span> <span class="token number">0.6311843412704754</span><span class="token punctuation">,</span>
  pitch<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">40.852126070429755</span><span class="token punctuation">,</span>
  roll<span class="token operator">:</span> <span class="token number">359.9998440596327</span><span class="token punctuation">,</span>
  brightness<span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
  saturation<span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 地图视角fly</span>
<span class="token keyword">function</span> <span class="token function">mapFlyTo</span><span class="token punctuation">(</span><span class="token parameter">style</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">let</span> initialPosition <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span>
        style<span class="token punctuation">.</span>lng<span class="token punctuation">,</span>
        style<span class="token punctuation">.</span>lat<span class="token punctuation">,</span>
        style<span class="token punctuation">.</span>height
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> initialOrientation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>HeadingPitchRoll<span class="token punctuation">.</span>fromDegrees</span><span class="token punctuation">(</span>
        style<span class="token punctuation">.</span>heading<span class="token punctuation">,</span>
        style<span class="token punctuation">.</span>pitch<span class="token punctuation">,</span>
        style<span class="token punctuation">.</span>roll
      <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化相机对准方向1：左右摆动角度；2：上下俯仰角度；3：相机翻滚角度</span>
      cesiumScene<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">setView</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        destination<span class="token operator">:</span> initialPosition<span class="token punctuation">,</span>
        orientation<span class="token operator">:</span> initialOrientation<span class="token punctuation">,</span>
        endTransform<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Matrix4<span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="11、地图的鼠标移动事件"><a href="#11、地图的鼠标移动事件" class="headerlink" title="11、地图的鼠标移动事件"></a>11、地图的鼠标移动事件</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">mapMoveEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    mapFunction<span class="token punctuation">.</span>move <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>ScreenSpaceEventHandler</span><span class="token punctuation">(</span>cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mapFunction<span class="token punctuation">.</span>move<span class="token punctuation">.</span><span class="token function">setInputAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">click</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> pick <span class="token operator">=</span> cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span>click<span class="token punctuation">.</span>endPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pick <span class="token operator">&amp;&amp;</span> pick<span class="token punctuation">.</span>id<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token string">"cursor: pointer;"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token string">"cursor: default;"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">MOUSE_MOVE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="12、设置地图泛光效果"><a href="#12、设置地图泛光效果" class="headerlink" title="12、设置地图泛光效果"></a>12、设置地图泛光效果</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/*************************开始-设置屏幕泛光【周浩20200923增加】**********************/</span>
<span class="token keyword">var</span> stages <span class="token operator">=</span> cesiumScene<span class="token punctuation">.</span>postProcessStages<span class="token punctuation">;</span>
cesiumScene<span class="token punctuation">.</span>brightness <span class="token operator">=</span> cesiumScene<span class="token punctuation">.</span>brightness <span class="token operator">||</span> stages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>PostProcessStageLibrary<span class="token punctuation">.</span><span class="token function">createBrightnessStage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cesiumScene<span class="token punctuation">.</span>brightness<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
cesiumScene<span class="token punctuation">.</span>brightness<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>brightness <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> viewModel <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    contrast<span class="token operator">:</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token comment">//128</span>
    brightness<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">//-0.3</span>
    delta<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//设置泛光度 1.0</span>
    sigma<span class="token operator">:</span> <span class="token number">3.78</span><span class="token punctuation">,</span> <span class="token comment">//3.78</span>
    stepSize<span class="token operator">:</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token comment">//5.0</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> bloom <span class="token operator">=</span> cesiumScene<span class="token punctuation">.</span>postProcessStages<span class="token punctuation">.</span>bloom
bloom<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span>
bloom<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>glowOnly <span class="token operator">=</span> <span class="token boolean">false</span>
bloom<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>contrast <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>contrast<span class="token punctuation">)</span>
bloom<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>brightness <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>brightness<span class="token punctuation">)</span>
bloom<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>delta <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>delta<span class="token punctuation">)</span>
bloom<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>sigma <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>sigma<span class="token punctuation">)</span>
bloom<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>stepSize <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>stepSize<span class="token punctuation">)</span>
<span class="token comment">/*************************结束-设置屏幕泛光**********************/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="13、cesium的地图初始化"><a href="#13、cesium的地图初始化" class="headerlink" title="13、cesium的地图初始化"></a>13、cesium的地图初始化</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> pTileProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>ArcGisMapServerImageryProvider</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//影像瓦片驱动</span>
    url<span class="token operator">:</span> <span class="token string">'https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer'</span><span class="token punctuation">,</span>
    <span class="token comment">// 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer',</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// terrainProvider = new Cesium.CesiumTerrainProvider(&#123; //地形瓦片驱动</span>
<span class="token comment">//     url: terrainProviderUrl</span>
<span class="token comment">// &#125;);</span>
cesiumView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Viewer</span><span class="token punctuation">(</span><span class="token string">"mapBox"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    animation<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示动画控件</span>
    shouldAnimate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    homeButton<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示Home按钮</span>
    fullscreenButton<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示全屏按钮</span>
    baseLayerPicker<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示图层选择控件</span>
    geocoder<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示地名查找控件</span>
    timeline<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示时间线控件</span>
    sceneModePicker<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//是否显示投影方式控件</span>
    navigationHelpButton<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示帮助信息控件</span>
    infoBox<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否显示点击要素之后显示的信息</span>
    <span class="token comment">// infoBox: true, //是否显示点击要素之后显示的信息</span>
    <span class="token comment">// requestRenderMode: true, //启用请求渲染模式</span>
    requestRenderMode<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//启用请求渲染模式</span>
    scene3DOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//每个几何实例将只能以3D渲染以节省GPU内存</span>
    sceneMode<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">//初始场景模式 1 2D模式 2 2D循环模式 3 3D模式  Cesium.SceneMode</span>
    <span class="token comment">// fullscreenElement: document.body, //全屏时渲染的HTML元素 暂时没发现用处</span>
    selectionIndicator<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// terrainProvider: terrainProvider,</span>
    imageryProvider<span class="token operator">:</span> pTileProvider<span class="token punctuation">,</span>
    skyAtmosphere<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>measure <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Measure</span><span class="token punctuation">(</span>cesiumView<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 测量面板 见cesium的插件引用</span>
cesiumScene <span class="token operator">=</span> cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">;</span>
cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>depthTestAgainstTerrain <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//控制视角,能被地形遮挡</span>
cesiumEllipsoid <span class="token operator">=</span> cesiumScene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">;</span>
cesiumView<span class="token punctuation">.</span>_cesiumWidget<span class="token punctuation">.</span>_creditContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="14、设置墙向上的流动效果"><a href="#14、设置墙向上的流动效果" class="headerlink" title="14、设置墙向上的流动效果"></a>14、设置墙向上的流动效果</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 生成场站范围区域动效，从下往上</span>
<span class="token function-variable function">loadAreaStyle</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> duration</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_definitionChanged <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Event</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_color <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_colorSubscription <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>duration <span class="token operator">=</span> duration<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token class-name">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        isConstant<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        definitionChanged<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_definitionChanged<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> Cesium<span class="token punctuation">.</span><span class="token function">createPropertyDescriptor</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getType</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"PolylineTrailLink"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token class-name">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Cesium<span class="token punctuation">.</span><span class="token function">defined</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        result<span class="token punctuation">.</span>color <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Property<span class="token punctuation">.</span><span class="token function">getValueOrClonedDefault</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_color<span class="token punctuation">,</span> time<span class="token punctuation">,</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">WHITE</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span>image <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkImage<span class="token punctuation">;</span>
        result<span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_time<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token class-name">PolylineTrailLinkMaterialProperty</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">equals</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> other <span class="token operator">||</span> <span class="token punctuation">(</span>other <span class="token keyword">instanceof</span> <span class="token class-name">PolylineTrailLinkMaterialProperty</span> <span class="token operator">&amp;&amp;</span> Property<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_color<span class="token punctuation">,</span> other<span class="token punctuation">.</span>_color<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    Cesium<span class="token punctuation">.</span>PolylineTrailLinkMaterialProperty <span class="token operator">=</span> PolylineTrailLinkMaterialProperty<span class="token punctuation">;</span>
    Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkType <span class="token operator">=</span> <span class="token string">"PolylineTrailLink"</span><span class="token punctuation">;</span>
    <span class="token comment">//---------------------------------------------设置图片url ---------------------------------------------</span>
    Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkImage <span class="token operator">=</span> wallpng<span class="token punctuation">;</span>
    <span class="token comment">//---------------------------------------------设置流动方式 ---------------------------------------------</span>
    <span class="token comment">// 着色器代码</span>
    Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkSource <span class="token operator">=</span> <span class="token string">"czm_material czm_getMaterial(czm_materialInput materialInput)\n\
&#123;\n\
    czm_material material = czm_getDefaultMaterial(materialInput);\n\
    vec2 st = materialInput.st;\n\
    vec4 colorImage = texture2D(image, vec2(fract(st.t - time), st.t));\n\
    material.alpha = colorImage.a * color.a;\n\
    material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n\
    return material;\n\
&#125;"</span><span class="token punctuation">;</span>
    Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>_materialCache<span class="token punctuation">.</span><span class="token function">addMaterial</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkType<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        fabric<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkType<span class="token punctuation">,</span>
            uniforms<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                color<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                image<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkImage<span class="token punctuation">,</span>
                time<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            source<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Material<span class="token punctuation">.</span>PolylineTrailLinkSource<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">translucent</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">material</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*-------------------------调用示例颜色 时间(速度) ----------------------------*/</span>
    <span class="token comment">// 材质</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>p_material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolylineTrailLinkMaterialProperty</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">FUCHSIA</span><span class="token punctuation">.</span><span class="token function">withAlpha</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="15、添加点图层"><a href="#15、添加点图层" class="headerlink" title="15、添加点图层"></a>15、添加点图层</h2><h3 id="1、Entity-添加点图层"><a href="#1、Entity-添加点图层" class="headerlink" title="1、Entity 添加点图层"></a>1、Entity 添加点图层</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 创建point Entity数据集</span>
<span class="token keyword">const</span> pointLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>CustomDataSource</span><span class="token punctuation">(</span><span class="token string">"pointLayer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 向地图里面添加数据集</span>
viewer<span class="token punctuation">.</span>dataSources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pointLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">loadchangzhan</span><span class="token punctuation">(</span><span class="token parameter">pointData<span class="token punctuation">,</span> pointLayer</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    pointData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token string">"场站"</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> entityObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            name<span class="token operator">:</span> <span class="token string">"点点点"</span><span class="token punctuation">,</span>
            id<span class="token operator">:</span> item<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span> type<span class="token punctuation">,</span>
            position<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>longitude<span class="token punctuation">,</span> item<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            show<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            billboard<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                image<span class="token operator">:</span> icon<span class="token punctuation">,</span>
                scale<span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
                distanceDisplayCondition<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>DistanceDisplayCondition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">135000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                verticalOrigin<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>VerticalOrigin<span class="token punctuation">.</span><span class="token constant">BOTTOM</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            label<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                text<span class="token operator">:</span> <span class="token string">"加点"</span><span class="token punctuation">,</span>
                font<span class="token operator">:</span> <span class="token number">14</span> <span class="token operator">+</span> <span class="token string">"px sans-serif"</span><span class="token punctuation">,</span>
                pixelOffset<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                distanceDisplayCondition<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>DistanceDisplayCondition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                fillColor<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">AQUA</span><span class="token punctuation">,</span>
                showBackground<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                backgroundColor<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        entityObj<span class="token punctuation">.</span><span class="token function">addProperty</span><span class="token punctuation">(</span><span class="token string">"extendedData"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        entityObj<span class="token punctuation">.</span>extendedData <span class="token operator">=</span> properties<span class="token punctuation">;</span>
        entityObj<span class="token punctuation">.</span>extendedData<span class="token punctuation">[</span><span class="token string">'lng'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pointDataArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        entityObj<span class="token punctuation">.</span>extendedData<span class="token punctuation">[</span><span class="token string">'lat'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pointDataArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pointLayer<span class="token punctuation">.</span>entities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entityObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pointLayer<span class="token punctuation">.</span>entities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entityObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2、Primitives-添加点图层"><a href="#2、Primitives-添加点图层" class="headerlink" title="2、Primitives 添加点图层"></a>2、Primitives 添加点图层</h3><pre class="line-numbers language-js" data-language="js"><code class="language-js">billboardParams<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      name<span class="token operator">:</span> <span class="token string">'图标参数设置'</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">'group'</span><span class="token punctuation">,</span>
      children<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        imgUrl<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'图标URL'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'http://localhost:8089/icon/point.png'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        imgWidth<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'图标宽'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'20'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        imgHeight<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'图标高'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'20'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        imgScale<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'图标缩放比'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'1'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        billboardsHeight<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'图标基于地面的高度'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'20'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    labelParams<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      name<span class="token operator">:</span> <span class="token string">'标签参数设置'</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">'group'</span><span class="token punctuation">,</span>
      children<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        labelFont<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'标签字体和大小'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'14px sans-serif'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        labelColor<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'标签颜色(RGBA)'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'233,34,234,0.9'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        labelBackgroundColor<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'背景颜色(RGBA)'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'233,255,255,0.9'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        labelBackgroundShow<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'背景显隐'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'true'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        labelScale<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'字体缩放比'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'1'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        labelPixelOffset<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          name<span class="token operator">:</span> <span class="token string">'标签偏移'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
          def<span class="token operator">:</span> <span class="token string">'0,-10'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> 

<span class="token comment">// 3、添加点注记</span>
  <span class="token function">addPointInstance</span> <span class="token punctuation">(</span><span class="token parameter">cesiumScene<span class="token punctuation">,</span> features<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function">addPoint</span> <span class="token punctuation">(</span><span class="token parameter">cesiumScene</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 创建广告牌的primitive</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>billboards <span class="token operator">=</span> cesiumScene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>BillboardCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 创建标注的primitive</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>labels <span class="token operator">=</span> cesiumScene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>LabelCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 创建集合</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pointDataCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PrimitiveCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>billboardParams <span class="token operator">=</span> options<span class="token punctuation">.</span>billboardParams<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>labelParams <span class="token operator">=</span> options<span class="token punctuation">.</span>labelParams

    <span class="token punctuation">&#125;</span>
    addPoint<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getPointDataFeatures</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> features<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    addPoint<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">addPointCollection</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 添加集合</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pointDataCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>billboards<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pointDataCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>labels<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    addPoint<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">addLabelBillboards</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">let</span> labelColor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>labelParams<span class="token punctuation">.</span>labelColor<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Number<span class="token punctuation">)</span>
      <span class="token keyword">let</span> labelBackgroundColor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>labelParams<span class="token punctuation">.</span>labelBackgroundColor<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Number<span class="token punctuation">)</span>
      <span class="token keyword">let</span> labelPixelOffset <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>labelParams<span class="token punctuation">.</span>labelPixelOffset<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Number<span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> features<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> pointDataArray <span class="token operator">=</span> features<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>coordinates<span class="token punctuation">;</span>
        <span class="token keyword">const</span> properties <span class="token operator">=</span> features<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">;</span>
        <span class="token comment">// add Label</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>labels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          show<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          position<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span>
            pointDataArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            pointDataArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          id<span class="token operator">:</span> properties<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
          text<span class="token operator">:</span> properties<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          font<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>labelParams<span class="token punctuation">.</span>labelFont<span class="token punctuation">,</span>
          fillColor<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span>labelColor<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> labelColor<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> labelColor<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> labelColor<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          outlineColor<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">BLACK</span><span class="token punctuation">,</span>
          outlineWidth<span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
          showBackground<span class="token operator">:</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>labelParams<span class="token punctuation">.</span>labelBackgroundShow<span class="token punctuation">)</span><span class="token punctuation">,</span>
          backgroundColor<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span>labelBackgroundColor<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> labelBackgroundColor<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> labelBackgroundColor<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> labelBackgroundColor<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          backgroundPadding<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          style<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>LabelStyle<span class="token punctuation">.</span><span class="token constant">FILL</span><span class="token punctuation">,</span>
          pixelOffset<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span>labelPixelOffset<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> labelPixelOffset<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment">// eyeOffset: Cesium.Cartesian3.ZERO,</span>
          horizontalOrigin<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>HorizontalOrigin<span class="token punctuation">.</span><span class="token constant">CENTER</span><span class="token punctuation">,</span>
          verticalOrigin<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>VerticalOrigin<span class="token punctuation">.</span><span class="token constant">BOTTOM</span><span class="token punctuation">,</span>
          scale<span class="token operator">:</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>labelParams<span class="token punctuation">.</span>labelScale<span class="token punctuation">)</span>
          <span class="token comment">// translucencyByDistance: undefined,</span>
          <span class="token comment">// pixelOffsetScaleByDistance: undefined,</span>
          <span class="token comment">// heightReference: HeightReference.NONE // 基础的高度参考</span>
          <span class="token comment">// distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 50000) // 该条件指定将在距摄像机的距离显示此广告牌。</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// add BillBoards</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>billboards<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          show<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          position<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span>
            pointDataArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            pointDataArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>billboardParams<span class="token punctuation">.</span>billboardsHeight<span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment">// pixelOffset: Cesium.Cartesian2.ZERO,</span>
          <span class="token comment">// eyeOffset: Cesium.Cartesian3.ZERO,</span>
          heightReference<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>HeightReference<span class="token punctuation">.</span><span class="token constant">RELATIVE_TO_GROUND</span><span class="token punctuation">,</span> <span class="token comment">//RELATIVE===CLAMP_TO_GROUND===NONE,</span>
          horizontalOrigin<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>HorizontalOrigin<span class="token punctuation">.</span><span class="token constant">CENTER</span><span class="token punctuation">,</span>
          verticalOrigin<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>VerticalOrigin<span class="token punctuation">.</span><span class="token constant">CENTER</span><span class="token punctuation">,</span>
          scale<span class="token operator">:</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>billboardParams<span class="token punctuation">.</span>imgScale<span class="token punctuation">)</span><span class="token punctuation">,</span>
          image<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>billboardParams<span class="token punctuation">.</span>imgUrl<span class="token punctuation">,</span>
          <span class="token comment">// imageSubRegion: undefined,</span>
          color<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">WHITE</span><span class="token punctuation">,</span>
          id<span class="token operator">:</span> properties<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
          rotation<span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token comment">// 获取或设置弧度的旋转角度。</span>
          width<span class="token operator">:</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>billboardParams<span class="token punctuation">.</span>imgWidth<span class="token punctuation">)</span><span class="token punctuation">,</span>
          height<span class="token operator">:</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>billboardParams<span class="token punctuation">.</span>imgHeight<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment">// scaleByDistance: undefined,</span>
          <span class="token comment">// translucencyByDistance: undefined,</span>
          <span class="token comment">// pixelOffsetScaleByDistance: undefined,</span>
          sizeInMeters<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 设置广告牌大小是否以米或像素为单位。 true 以米为单位确定广告牌的大小；否则，大小以像素为单位。</span>
          <span class="token comment">// distanceDisplayCondition: undefined</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    addPoint<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">showPoint</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">show</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> billboards <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointDataCollection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_billboards<span class="token punctuation">;</span>
      <span class="token keyword">const</span> labels <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointDataCollection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_labels<span class="token punctuation">;</span>
      billboards<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">billboard</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        billboard<span class="token punctuation">.</span>show <span class="token operator">=</span> show<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      labels<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">label</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        label<span class="token punctuation">.</span>show <span class="token operator">=</span> show<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>addPoint<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">addPoint</span><span class="token punctuation">(</span>cesiumScene<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="16、Entity-添加线图层"><a href="#16、Entity-添加线图层" class="headerlink" title="16、Entity 添加线图层"></a>16、Entity 添加线图层</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 创建polyline Entity数据集</span>
<span class="token keyword">const</span> polylineLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>CustomDataSource</span><span class="token punctuation">(</span><span class="token string">"polylineLayer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
viewer<span class="token punctuation">.</span>dataSources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>polylineLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 向地图里面添加数据集</span>
<span class="token function">initMainGuanXian</span><span class="token punctuation">(</span><span class="token parameter">polylineData<span class="token punctuation">,</span> polylineLayer</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> lineColor <span class="token operator">=</span> lineColor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">220</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token string">"管线"</span><span class="token punctuation">;</span>
    polylineData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> lineDataCoor <span class="token operator">=</span> item<span class="token punctuation">.</span>coordinateList <span class="token operator">||</span> item<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        layerType<span class="token punctuation">.</span>entities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            name<span class="token operator">:</span> <span class="token string">"管线"</span><span class="token punctuation">,</span>
            id<span class="token operator">:</span> item<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span> type
            polyline<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                positions<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegreesArray</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span>
                width<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                material<span class="token operator">:</span> lineColor<span class="token punctuation">,</span>
                <span class="token comment">// material: guanxianStyle.success,</span>
                clampToGround<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="17、cesium信息框动态显示并跟随移动（高度会影响定位精度）"><a href="#17、cesium信息框动态显示并跟随移动（高度会影响定位精度）" class="headerlink" title="17、cesium信息框动态显示并跟随移动（高度会影响定位精度）"></a>17、cesium信息框动态显示并跟随移动（高度会影响定位精度）</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">htmlFixed</span><span class="token punctuation">(</span><span class="token parameter">viewer<span class="token punctuation">,</span> domId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> htmlOverlay <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>domId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> domHeight <span class="token operator">=</span> htmlOverlay<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span> <span class="token comment">// DOM的高度</span>
    <span class="token keyword">const</span> domWidth <span class="token operator">=</span> htmlOverlay<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span> <span class="token comment">// DOM的宽度</span>
    <span class="token keyword">const</span> heightOffset <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// Y轴偏移量</span>
    <span class="token keyword">const</span> widthOffset <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">;</span> <span class="token comment">// X轴偏移量</span>

    <span class="token keyword">const</span> scratch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>preRender<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">let</span> position <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span>lnglat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lnglat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> canvasPosition <span class="token operator">=</span> cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">cartesianToCanvasCoordinates</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> scratch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span><span class="token function">defined</span><span class="token punctuation">(</span>canvasPosition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        htmlOverlay<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> canvasPosition<span class="token punctuation">.</span>y <span class="token operator">-</span> domHeight <span class="token operator">-</span> heightOffset <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
        htmlOverlay<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> canvasPosition<span class="token punctuation">.</span>x <span class="token operator">-</span> domWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> widthOffset <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// DOM绑定数据</span>
<span class="token comment">//     &lt;div v-infoBoxPosition="(that)"</span>
<span class="token comment">//         class="info-box-position"</span>
<span class="token comment">//         v-for="(item,index) in infoBoxPosition"</span>
<span class="token comment">//         :key=index</span>
<span class="token comment">//         :data-position=item.lnglat></span>

<span class="token comment">// 自定义组件</span>
directives<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
   <span class="token function">infoBoxPosition</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">let</span> height <span class="token operator">=</span> cesiumScene<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>positionCartographic<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
      <span class="token comment">// 当相机的高度大于700000，信息框就隐藏</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>height <span class="token operator">></span> <span class="token number">700000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        binding<span class="token punctuation">.</span>value<span class="token punctuation">.</span>infoBoxPositionShow <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        binding<span class="token punctuation">.</span>value<span class="token punctuation">.</span>infoBoxPositionShow <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">&#125;</span>
        <span class="token keyword">const</span> dispradius <span class="token operator">=</span> el<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> scratch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>preRender<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> position <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span>dispradius<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dispradius<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> canvasPosition <span class="token operator">=</span> cesiumView<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">cartesianToCanvasCoordinates</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> scratch<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span><span class="token function">defined</span><span class="token punctuation">(</span>canvasPosition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> canvasPosition<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
                el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> canvasPosition<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="18、相机监听、获取中心点坐标、高度、当前可视区域范围"><a href="#18、相机监听、获取中心点坐标、高度、当前可视区域范围" class="headerlink" title="18、相机监听、获取中心点坐标、高度、当前可视区域范围"></a>18、相机监听、获取中心点坐标、高度、当前可视区域范围</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* 三维球转动添加监听事件 */</span>
  viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>changed<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">percentage</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">getCenterPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">getCurrentExtent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 打印中心点坐标、高度、当前范围坐标</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getCenterPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"bounds"</span><span class="token punctuation">,</span><span class="token function">getCurrentExtent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
  <span class="token comment">/* 获取camera高度  */</span>
  <span class="token keyword">function</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>viewer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">var</span> scene <span class="token operator">=</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">;</span>
      <span class="token keyword">var</span> ellipsoid <span class="token operator">=</span> scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">;</span>
      <span class="token keyword">var</span> height <span class="token operator">=</span> ellipsoid<span class="token punctuation">.</span><span class="token function">cartesianToCartographic</span><span class="token punctuation">(</span>viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
      <span class="token keyword">return</span> height<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
 
  <span class="token comment">/* 获取camera中心点坐标 */</span>
  <span class="token keyword">function</span> <span class="token function">getCenterPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">pickEllipsoid</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span>viewer<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> viewer<span class="token punctuation">.</span>canvas
      <span class="token punctuation">.</span>clientHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> curPosition <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Ellipsoid<span class="token punctuation">.</span><span class="token constant">WGS84</span><span class="token punctuation">.</span><span class="token function">cartesianToCartographic</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> lon <span class="token operator">=</span> curPosition<span class="token punctuation">.</span>longitude <span class="token operator">*</span> <span class="token number">180</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> lat <span class="token operator">=</span> curPosition<span class="token punctuation">.</span>latitude <span class="token operator">*</span> <span class="token number">180</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> height <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      lon<span class="token operator">:</span> lon<span class="token punctuation">,</span>
      lat<span class="token operator">:</span> lat<span class="token punctuation">,</span>
      height<span class="token operator">:</span> height
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
 
  <span class="token keyword">function</span> <span class="token function">getCurrentExtent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 范围对象</span>
      <span class="token keyword">var</span> extent <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
 
      <span class="token comment">// 得到当前三维场景</span>
      <span class="token keyword">var</span> scene <span class="token operator">=</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">;</span>
 
      <span class="token comment">// 得到当前三维场景的椭球体</span>
      <span class="token keyword">var</span> ellipsoid <span class="token operator">=</span> scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">;</span>
      <span class="token keyword">var</span> canvas <span class="token operator">=</span> scene<span class="token punctuation">.</span>canvas<span class="token punctuation">;</span>
 
      <span class="token comment">// canvas左上角</span>
      <span class="token keyword">var</span> car3_lt <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">pickEllipsoid</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ellipsoid<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
      <span class="token comment">// canvas右下角</span>
      <span class="token keyword">var</span> car3_rb <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">pickEllipsoid</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span> ellipsoid<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
      <span class="token comment">// 当canvas左上角和右下角全部在椭球体上</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>car3_lt <span class="token operator">&amp;&amp;</span> car3_rb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">var</span> carto_lt <span class="token operator">=</span> ellipsoid<span class="token punctuation">.</span><span class="token function">cartesianToCartographic</span><span class="token punctuation">(</span>car3_lt<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> carto_rb <span class="token operator">=</span> ellipsoid<span class="token punctuation">.</span><span class="token function">cartesianToCartographic</span><span class="token punctuation">(</span>car3_rb<span class="token punctuation">)</span><span class="token punctuation">;</span>
          extent<span class="token punctuation">.</span>xmin <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>carto_lt<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
          extent<span class="token punctuation">.</span>ymax <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>carto_lt<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
          extent<span class="token punctuation">.</span>xmax <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>carto_rb<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
          extent<span class="token punctuation">.</span>ymin <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>carto_rb<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
 
      <span class="token comment">// 当canvas左上角不在但右下角在椭球体上</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>car3_lt <span class="token operator">&amp;&amp;</span> car3_rb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">var</span> car3_lt2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> yIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
              <span class="token comment">// 这里每次10像素递加，一是10像素相差不大，二是为了提高程序运行效率</span>
              yIndex <span class="token operator">&lt;=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">?</span> yIndex <span class="token operator">+=</span> <span class="token number">10</span> <span class="token operator">:</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
              car3_lt2 <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">pickEllipsoid</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> yIndex<span class="token punctuation">)</span><span class="token punctuation">,</span> ellipsoid<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>car3_lt2<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> carto_lt2 <span class="token operator">=</span> ellipsoid<span class="token punctuation">.</span><span class="token function">cartesianToCartographic</span><span class="token punctuation">(</span>car3_lt2<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> carto_rb2 <span class="token operator">=</span> ellipsoid<span class="token punctuation">.</span><span class="token function">cartesianToCartographic</span><span class="token punctuation">(</span>car3_rb<span class="token punctuation">)</span><span class="token punctuation">;</span>
          extent<span class="token punctuation">.</span>xmin <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>carto_lt2<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
          extent<span class="token punctuation">.</span>ymax <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>carto_lt2<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
          extent<span class="token punctuation">.</span>xmax <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>carto_rb2<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
          extent<span class="token punctuation">.</span>ymin <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>carto_rb2<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
 
      <span class="token comment">// 获取高度</span>
      extent<span class="token punctuation">.</span>height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>positionCartographic<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> extent<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="19、地图放大缩小、经纬度显示"><a href="#19、地图放大缩小、经纬度显示" class="headerlink" title="19、地图放大缩小、经纬度显示"></a>19、地图放大缩小、经纬度显示</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 放大缩小</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'zoomIn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 获取当前镜头位置的笛卡尔坐标</span>
    <span class="token keyword">let</span> cameraPos <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">;</span>
    <span class="token comment">// 获取当前坐标系标准</span>
    <span class="token keyword">let</span> ellipsoid <span class="token operator">=</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">;</span>

    <span class="token comment">// 根据坐标系标准，将笛卡尔坐标转换为地理坐标</span>
    <span class="token keyword">let</span> cartographic <span class="token operator">=</span> ellipsoid<span class="token punctuation">.</span><span class="token function">cartesianToCartographic</span><span class="token punctuation">(</span>cameraPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取镜头的高度</span>
    <span class="token keyword">let</span> height <span class="token operator">=</span> cartographic<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    <span class="token comment">// if (height &lt; 40) &#123;</span>
    <span class="token comment">//   return</span>
    <span class="token comment">// &#125;</span>
    <span class="token comment">// 镜头拉近</span>
    viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">zoomIn</span><span class="token punctuation">(</span>height <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'zoomOut'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 获取当前镜头位置的笛卡尔坐标</span>
    <span class="token keyword">let</span> cameraPos <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">;</span>
    <span class="token comment">// 获取当前坐标系标准</span>
    <span class="token keyword">let</span> ellipsoid <span class="token operator">=</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">;</span>

    <span class="token comment">// 根据坐标系标准，将笛卡尔坐标转换为地理坐标</span>
    <span class="token keyword">let</span> cartographic <span class="token operator">=</span> ellipsoid<span class="token punctuation">.</span><span class="token function">cartesianToCartographic</span><span class="token punctuation">(</span>cameraPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取镜头的高度</span>
    <span class="token keyword">let</span> height <span class="token operator">=</span> cartographic<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    <span class="token comment">// if (height &lt; 40) &#123;</span>
    <span class="token comment">//   return</span>
    <span class="token comment">// &#125;</span>
    <span class="token comment">// 镜头拉近</span>
    viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">zoomOut</span><span class="token punctuation">(</span>height <span class="token operator">*</span> <span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token comment">//经纬度显示</span>
  viewer<span class="token punctuation">.</span>screenSpaceEventHandler<span class="token punctuation">.</span><span class="token function">setInputAction</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> earthPosition <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">pickEllipsoid</span><span class="token punctuation">(</span>
      event<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
      viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> cartographic <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartographic<span class="token punctuation">.</span><span class="token function">fromCartesian</span><span class="token punctuation">(</span>
      earthPosition<span class="token punctuation">,</span>
      viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartographic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> lat <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>cartographic<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> lng <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>cartographic<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> height <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>positionCartographic<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'infobox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span>
      <span class="token string">'&lt;span>经度：'</span> <span class="token operator">+</span>
      lng<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token string">'&lt;/span>'</span> <span class="token operator">+</span>
      <span class="token string">'&lt;span>  纬度：'</span> <span class="token operator">+</span>
      lat<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token string">'&lt;/span>'</span> <span class="token operator">+</span>
      <span class="token string">'&lt;span>  相机高度：'</span> <span class="token operator">+</span>
      height <span class="token operator">+</span>
      <span class="token string">'&lt;/span>'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lng<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_CLICK</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="20、RGBA-方法"><a href="#20、RGBA-方法" class="headerlink" title="20、RGBA  方法"></a>20、RGBA  方法</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js">
<span class="token class-name">String</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">colorHex</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// RGB颜色值的正则</span>
  <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(rgb|RGB)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> strHex <span class="token operator">=</span> <span class="token string">"#"</span><span class="token punctuation">;</span>
    <span class="token comment">// 把RGB的3个数值变成数组</span>
    <span class="token keyword">var</span> colorArr <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?:\(|\)|rgb|RGB)*</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 转成16进制</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> colorArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">var</span> hex <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>colorArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hex <span class="token operator">===</span> <span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        hex <span class="token operator">+=</span> hex<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      strHex <span class="token operator">+=</span> hex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> strHex<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>






<span class="token class-name">String</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">colorRgb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 16进制颜色值的正则</span>
  <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^#([0-9a-fA-f]&#123;3&#125;|[0-9a-fA-f]&#123;6&#125;)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
  <span class="token comment">// 把颜色值变成小写</span>
  <span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 如果只有三位的值，需变成六位，如：#fff => #ffffff</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">var</span> colorNew <span class="token operator">=</span> <span class="token string">"#"</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        colorNew <span class="token operator">+=</span> color<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      color <span class="token operator">=</span> colorNew<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 处理六位的颜色值，转为RGB</span>
    <span class="token keyword">var</span> colorChange <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      colorChange<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"0x"</span> <span class="token operator">+</span> color<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token string">"RGB("</span> <span class="token operator">+</span> colorChange<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> color<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="21、CESIUM-模型加载"><a href="#21、CESIUM-模型加载" class="headerlink" title="21、CESIUM   模型加载"></a>21、CESIUM   模型加载</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> hpr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>HeadingPitchRoll</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toRadians</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">var</span> position <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span>
   featureItem<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> featureItem<span class="token punctuation">.</span>lon<span class="token punctuation">,</span>
   featureItem<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> featureItem<span class="token punctuation">.</span>lat<span class="token punctuation">,</span>
   <span class="token number">2</span>
 <span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">let</span> entityObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Entity</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
   name<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
   id<span class="token operator">:</span> featureItem<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
   position<span class="token operator">:</span> position<span class="token punctuation">,</span>
   orientation<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Transforms<span class="token punctuation">.</span><span class="token function">headingPitchRollQuaternion</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> hpr<span class="token punctuation">)</span> <span class="token comment">// 方向</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>方法一：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createModel</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    viewer<span class="token punctuation">.</span>entities<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> position <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">123.0744619</span><span class="token punctuation">,</span> <span class="token number">44.0503706</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> heading <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toRadians</span><span class="token punctuation">(</span><span class="token number">135</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pitch <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> roll <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> hpr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>HeadingPitchRoll</span><span class="token punctuation">(</span>heading<span class="token punctuation">,</span> pitch<span class="token punctuation">,</span> roll<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> orientation <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Transforms<span class="token punctuation">.</span><span class="token function">headingPitchRollQuaternion</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> hpr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> entity <span class="token operator">=</span> viewer<span class="token punctuation">.</span>entities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        name <span class="token operator">:</span> url<span class="token punctuation">,</span>
        position <span class="token operator">:</span> position<span class="token punctuation">,</span>
        orientation <span class="token operator">:</span> orientation<span class="token punctuation">,</span>
        model <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            uri <span class="token operator">:</span> url<span class="token punctuation">,</span>
            minimumPixelSize <span class="token operator">:</span> <span class="token number">128</span><span class="token punctuation">,</span>
            maximumScale <span class="token operator">:</span> <span class="token number">20000</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    viewer<span class="token punctuation">.</span>trackedEntity <span class="token operator">=</span> entity<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>方法二：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createModel</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> height<span class="token punctuation">,</span> heading<span class="token punctuation">,</span> pitch<span class="token punctuation">,</span> roll</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    height <span class="token operator">=</span> Cesium<span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    heading <span class="token operator">=</span> Cesium<span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span>heading<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pitch <span class="token operator">=</span> Cesium<span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span>pitch<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    roll <span class="token operator">=</span> Cesium<span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span>roll<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> hpr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>HeadingPitchRoll</span><span class="token punctuation">(</span>heading<span class="token punctuation">,</span> pitch<span class="token punctuation">,</span> roll<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> origin <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">123.0744619</span><span class="token punctuation">,</span> <span class="token number">44.0503706</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> modelMatrix <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Transforms<span class="token punctuation">.</span><span class="token function">headingPitchRollToFixedFrame</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> hpr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    scene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Remove previous model</span>
    model <span class="token operator">=</span> scene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>Model<span class="token punctuation">.</span><span class="token function">fromGltf</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url <span class="token operator">:</span> url<span class="token punctuation">,</span>
        modelMatrix <span class="token operator">:</span> modelMatrix<span class="token punctuation">,</span>
        minimumPixelSize <span class="token operator">:</span> <span class="token number">128</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    model<span class="token punctuation">.</span>readyPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        model<span class="token punctuation">.</span>color <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token function">fromAlpha</span><span class="token punctuation">(</span><span class="token function">getColor</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Number</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span>colorBlendMode <span class="token operator">=</span> <span class="token function">getColorBlendMode</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>colorBlendMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span>colorBlendAmount <span class="token operator">=</span> viewModel<span class="token punctuation">.</span>colorBlendAmount<span class="token punctuation">;</span>
        <span class="token comment">// Play and loop all animations at half-speed</span>
        model<span class="token punctuation">.</span>activeAnimations<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            speedup <span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
            loop <span class="token operator">:</span> Cesium<span class="token punctuation">.</span>ModelAnimationLoop<span class="token punctuation">.</span><span class="token constant">REPEAT</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> camera <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">;</span>

        <span class="token comment">// Zoom to model</span>
        <span class="token keyword">var</span> controller <span class="token operator">=</span> scene<span class="token punctuation">.</span>screenSpaceCameraController<span class="token punctuation">;</span>
        <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>boundingSphere<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>frustum<span class="token punctuation">.</span>near<span class="token punctuation">)</span><span class="token punctuation">;</span>
        controller<span class="token punctuation">.</span>minimumZoomDistance <span class="token operator">=</span> r <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> center <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Matrix4<span class="token punctuation">.</span><span class="token function">multiplyByPoint</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>modelMatrix<span class="token punctuation">,</span> model<span class="token punctuation">.</span>boundingSphere<span class="token punctuation">.</span>center<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> heading <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toRadians</span><span class="token punctuation">(</span><span class="token number">230.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> pitch <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toRadians</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>HeadingPitchRange</span><span class="token punctuation">(</span>heading<span class="token punctuation">,</span> pitch<span class="token punctuation">,</span> r <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">otherwise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="22、cesiumJI加载水（多面环形）"><a href="#22、cesiumJI加载水（多面环形）" class="headerlink" title="22、cesiumJI加载水（多面环形）"></a>22、cesiumJI加载水（多面环形）</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
x<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token function">loadWaterPrimitives</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">loadRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">loadPark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">load3DTile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/************************************开始-加载【3DTile】实体*************************************/</span>
<span class="token keyword">function</span> <span class="token function">load3DTile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> tj <span class="token operator">=</span> scene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cesium3DTileset</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url<span class="token operator">:</span> <span class="token string">'./resource/3dTiles/tileset.json'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/************************************结束-加载【3DTile】实体*************************************/</span>

<span class="token comment">/************************************开始-加载【水系】实体*************************************/</span>
<span class="token comment">//返回水面材质：s速度的倍数</span>
<span class="token keyword">function</span> <span class="token function">getWaterAppearance</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span>g<span class="token punctuation">,</span>b<span class="token punctuation">,</span>s</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>EllipsoidSurfaceAppearance</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        material<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Material</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            fabric<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                type<span class="token operator">:</span> <span class="token string">'Water'</span><span class="token punctuation">,</span>
                uniforms<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    baseWaterColor<span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//rgba颜色的对象基本颜色的水。0.0, 0.4, 0.9, 0.7</span>
                    <span class="token comment">// blendColor: new Cesium.Color(0.0, 0.4, 0.9, 0.2),//rgba颜色对象，用于混合从水到非水的地区。</span>
                    <span class="token comment">//specularMap: 'gray.jpg',//单通道纹理，用来表示水域。</span>
                    normalMap<span class="token operator">:</span> <span class="token string">'./resource/img/waterNormals.jpg'</span><span class="token punctuation">,</span><span class="token comment">//正态图:水正常扰动的正态图。</span>
                    frequency<span class="token operator">:</span> <span class="token number">1000.0</span><span class="token punctuation">,</span><span class="token comment">//频率:控制波数的数字。</span>
                    animationSpeed<span class="token operator">:</span> <span class="token number">0.01</span><span class="token operator">*</span>s<span class="token punctuation">,</span><span class="token comment">//动画速度:控制水的动画速度的数字。</span>
                    amplitude<span class="token operator">:</span> <span class="token number">5.0</span><span class="token punctuation">,</span><span class="token comment">//振幅:控制水波振幅的数字。</span>
                    specularIntensity<span class="token operator">:</span><span class="token number">1</span> <span class="token comment">//反射强度:控制镜面反射强度的数字。</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        fragmentShaderSource<span class="token operator">:</span> <span class="token string">'varying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\nvoid main()\n&#123;\nczm_materialInput materialInput;\nvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nmaterialInput.s = v_st.s;\nmaterialInput.st = v_st;\nmaterialInput.str = vec3(v_st, 0.0);\nmaterialInput.normalEC = normalEC;\nmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\nvec3 positionToEyeEC = -v_positionEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material);\
gl_FragColor.a=0.5;\n#endif\n&#125;\n'</span> <span class="token comment">//重写shader，修改水面的透明度</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> riversPrimitive<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//所有河流的Primitive</span>
<span class="token keyword">function</span> <span class="token function">loadWaterPrimitives</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> pWaters<span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'/resource/json/徐汇水系.json'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        pWaters<span class="token operator">=</span>data<span class="token punctuation">.</span>features<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pWaters<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">var</span> pPolygonHierarchy<span class="token punctuation">;</span>
            <span class="token keyword">var</span> range <span class="token operator">=</span> pWaters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>coordinates<span class="token punctuation">;</span>
            <span class="token keyword">var</span> river_code<span class="token operator">=</span>pWaters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>river_code<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//多边形无内洞</span>
            <span class="token punctuation">&#123;</span>
                pPolygonHierarchy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolygonHierarchy</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegreesArray</span><span class="token punctuation">(</span><span class="token function">setFormat</span><span class="token punctuation">(</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token comment">//多边形有内洞</span>
            <span class="token punctuation">&#123;</span>
                <span class="token keyword">var</span> holeHierarchys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> range<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    holeHierarchys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolygonHierarchy</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegreesArray</span><span class="token punctuation">(</span><span class="token function">setFormat</span><span class="token punctuation">(</span>range<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                pPolygonHierarchy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolygonHierarchy</span><span class="token punctuation">(</span>Cesium<span class="token punctuation">.</span>Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegreesArray</span><span class="token punctuation">(</span><span class="token function">setFormat</span><span class="token punctuation">(</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> holeHierarchys<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            

            <span class="token keyword">var</span> waterPrimitive <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Primitive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                show<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认隐藏</span>
                allowPicking<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                releaseGeometryInstances<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
                asynchronous<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
                geometryInstances<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>GeometryInstance</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    geometry<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolygonGeometry</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                        polygonHierarchy<span class="token operator">:</span> pPolygonHierarchy<span class="token punctuation">,</span>
                        height<span class="token operator">:</span><span class="token number">0.1</span>
                        <span class="token comment">// extrudedHeight: 50, //注释掉此属性可以只显示水面</span>
                        <span class="token comment">//  perPositionHeight: true //注释掉此属性水面就贴地了</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">// 可以设置内置的水面shader</span>
                appearance<span class="token operator">:</span> <span class="token function">getWaterAppearance</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">165</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
                <span class="token comment">// appearance: getWaterAppearance(Color[0][0]/255, Color[0][1]/255, Color[0][2]/255,2)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            scene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>waterPrimitive<span class="token punctuation">)</span><span class="token punctuation">;</span>
            riversPrimitive<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>waterPrimitive<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">setFormat</span><span class="token punctuation">(</span><span class="token parameter">waterlist</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> waterlist<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>waterlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>waterlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/************************************结束-加载【水系】实体*************************************/</span>


<span class="token comment">/************************************开始-加载【道路】实体*************************************/</span>
<span class="token keyword">function</span> <span class="token function">loadRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    Cesium<span class="token punctuation">.</span>GeoJsonDataSource<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"./resource/json/徐汇道路.json"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        clampToGround<span class="token operator">:</span> <span class="token operator">!</span><span class="token number">0</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        viewer<span class="token punctuation">.</span>dataSources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> l <span class="token operator">=</span> e<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>values<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> o <span class="token operator">&lt;</span> l<span class="token punctuation">.</span>length<span class="token punctuation">;</span> o<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> i <span class="token operator">=</span> l<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">;</span>
            i<span class="token punctuation">.</span>polyline<span class="token punctuation">.</span>material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>PolylineGlowMaterialProperty</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    glowPower<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    color<span class="token operator">:</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">ORANGERED</span><span class="token punctuation">.</span><span class="token function">withAlpha</span><span class="token punctuation">(</span><span class="token number">.5</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                i<span class="token punctuation">.</span>polyline<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">otherwise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/************************************结束-加载【道路】实体*************************************/</span>

<span class="token comment">/************************************开始-加载【绿地】实体*************************************/</span>
<span class="token keyword">function</span> <span class="token function">loadPark</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    Cesium<span class="token punctuation">.</span>GeoJsonDataSource<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"./resource/json/徐汇绿地.json"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        clampToGround<span class="token operator">:</span> <span class="token operator">!</span><span class="token number">0</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        viewer<span class="token punctuation">.</span>dataSources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> l <span class="token operator">=</span> e<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>values<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> o <span class="token operator">&lt;</span> l<span class="token punctuation">.</span>length<span class="token punctuation">;</span> o<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> i <span class="token operator">=</span> l<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">;</span>
            i<span class="token punctuation">.</span>polygon<span class="token punctuation">.</span>material <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Color<span class="token punctuation">.</span><span class="token constant">LIGHTGREEN</span><span class="token punctuation">;</span>
            i<span class="token punctuation">.</span>polygon<span class="token punctuation">.</span>height<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">;</span>
            <span class="token comment">// i.polygon.heightReference=Cesium.HeightReference.CLAMP_TO_GROUND;    </span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">otherwise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/************************************结束-加载【绿地】实体*************************************/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="23、经纬度-lt-gt-瓦片编号"><a href="#23、经纬度-lt-gt-瓦片编号" class="headerlink" title="23、经纬度&lt;=&gt;瓦片编号"></a>23、经纬度&lt;=&gt;瓦片编号</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 经纬度转瓦片编号</span>
<span class="token keyword">function</span> <span class="token function">lon2tile</span><span class="token punctuation">(</span><span class="token parameter">lon<span class="token punctuation">,</span>zoom</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>lon<span class="token operator">+</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">360</span><span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>zoom<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>
 <span class="token keyword">function</span> <span class="token function">lat2tile</span><span class="token punctuation">(</span><span class="token parameter">lat<span class="token punctuation">,</span>zoom</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span> 
   <span class="token keyword">return</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>lat<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">/</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>lat<span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>zoom<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token comment">// 瓦片编号转经纬度</span>
 <span class="token keyword">function</span> <span class="token function">tile2long</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>z</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>x<span class="token operator">/</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>z<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">360</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 <span class="token keyword">function</span> <span class="token function">tile2lat</span><span class="token punctuation">(</span><span class="token parameter">y<span class="token punctuation">,</span>z</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> n<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">*</span>y<span class="token operator">/</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">180</span><span class="token operator">/</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token function">atan</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">*</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">exp</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="24、cesium限制最大最小zoom等级高度"><a href="#24、cesium限制最大最小zoom等级高度" class="headerlink" title="24、cesium限制最大最小zoom等级高度"></a>24、cesium限制最大最小zoom等级高度</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js">viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>screenSpaceCameraController<span class="token punctuation">.</span>minimumZoomDistance <span class="token operator">=</span> <span class="token number">1200</span><span class="token punctuation">;</span>
viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>screenSpaceCameraController<span class="token punctuation">.</span>maximumZoomDistance <span class="token operator">=</span> <span class="token number">2500</span><span class="token punctuation">;</span>


<span class="token comment">/**
			 * 设置后当相机高度达到设置的最大和最小高度时将不再放大和缩小
			 */</span>
		viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>screenSpaceCameraController<span class="token punctuation">.</span>minimumZoomDistance <span class="token operator">=</span> <span class="token number">250000</span><span class="token punctuation">;</span><span class="token comment">//相机的高度的最小值</span>
		viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>screenSpaceCameraController<span class="token punctuation">.</span>maximumZoomDistance <span class="token operator">=</span> <span class="token number">22000000</span><span class="token punctuation">;</span>  <span class="token comment">//相机高度的最大值</span>
		viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>screenSpaceCameraController<span class="token punctuation">.</span>_minimumZoomRate <span class="token operator">=</span> <span class="token number">30000</span><span class="token punctuation">;</span> <span class="token comment">// 设置相机缩小时的速率</span>
		viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>screenSpaceCameraController<span class="token punctuation">.</span>_maximumZoomRate<span class="token operator">=</span><span class="token number">5906376272000</span>    <span class="token comment">//设置相机放大时的速率</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="cesium-插件使用"><a href="#cesium-插件使用" class="headerlink" title="cesium 插件使用"></a>cesium 插件使用</h1><h2 id="1、地图控件添加（比列尺、指北针等）"><a href="#1、地图控件添加（比列尺、指北针等）" class="headerlink" title="1、地图控件添加（比列尺、指北针等）"></a>1、地图控件添加（比列尺、指北针等）</h2><p><strong>1、安装 npm install cesium-navigation-es6</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 引入相关的模块</span>
<span class="token keyword">import</span> CesiumNavigation <span class="token keyword">from</span> <span class="token string">"cesium-navigation-es6"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 用于在使用重置导航重置地图视图时设置默认视图控制。接受的值是Cesium.Cartographic 和 Cesium.Rectangle.</span>
options<span class="token punctuation">.</span>defaultResetView <span class="token operator">=</span> Rectangle<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token comment">// 用于启用或禁用罗盘。true是启用罗盘，false是禁用罗盘。默认值为true。如果将选项设置为false，则罗盘将不会添加到地图中。</span>
options<span class="token punctuation">.</span>enableCompass <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 用于启用或禁用缩放控件。true是启用，false是禁用。默认值为true。如果将选项设置为false，则缩放控件将不会添加到地图中。</span>
options<span class="token punctuation">.</span>enableZoomControls <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">// 用于启用或禁用距离图例。true是启用，false是禁用。默认值为true。如果将选项设置为false，距离图例将不会添加到地图中。</span>
options<span class="token punctuation">.</span>enableDistanceLegend <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 用于启用或禁用指南针外环。true是启用，false是禁用。默认值为true。如果将选项设置为false，则该环将可见但无效。</span>
options<span class="token punctuation">.</span>enableCompassOuterRing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token function">CesiumNavigation</span><span class="token punctuation">(</span>cesiumView<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="2、cesium-的测量面板插件（测距、测面、）"><a href="#2、cesium-的测量面板插件（测距、测面、）" class="headerlink" title="2、cesium 的测量面板插件（测距、测面、）"></a>2、cesium 的测量面板插件（测距、测面、）</h2><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">"./mapShare/cesium-measure.js"</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>measure <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Measure</span><span class="token punctuation">(</span>cesiumView<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 示例如下</span>
<span class="token function">measureMap</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
            <span class="token comment">// 线的测量</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>measure<span class="token punctuation">.</span><span class="token function">drawLineMeasureGraphics</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                clampToGround<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            <span class="token comment">// 面的测量</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>measure<span class="token punctuation">.</span><span class="token function">drawAreaMeasureGraphics</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                clampToGround<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            <span class="token comment">// 清除测量的相关图层</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>measure<span class="token punctuation">.</span>_drawLayer<span class="token punctuation">.</span>entities<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


      </div>
      <div class="post-tags-categories">
        
        <div class="tags">
          
            <a href="/tags/Cesium/" class="">
              Cesium
            </a>
          
            <a href="/tags/gis/" class="">
              gis
            </a>
          
        </div>
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>作者:  </strong>Giser</a>
    </li>
    <li class="post-copyright-link">
    <strong>文章链接:  </strong>
    <a href="/2021/08/09/cesium方法合集/" target="_blank" title="cesium方法合集">https://gaochundu.github.io/2021/08/09/cesium方法合集/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明:   </strong>
      本网站所有文章除特别声明外,均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      许可协议。转载请注明出处!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      <!-- 文章详情页的上一页和下一页 -->
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="/medias/1.jpg" class="lazyload placeholder" data-srcset="/medias/1.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
    </div>
    <a href="/2021/08/30/3dtile%E4%BD%8D%E7%BD%AE%E8%B0%83%E6%95%B4/" class="post-nav-link">
      <div class="title">
        <i class="fas fa-angle-left"></i> 上一篇:
        <div class="title-text"></div>
      </div>
      
      <!-- <div class="content">
        cesium 3d-tiles平移、贴地、旋转和缩放目前只验证过cesiumlab处理的3dtiles数据，其他工具处理
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="/medias/1.jpg" class="lazyload placeholder" data-srcset="/medias/1.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" src="" alt="">
    </div>
    <a href="/2021/08/08/vscode%E5%90%8C%E6%AD%A5%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE/" class="post-nav-link">
      <div class="title">
        下一篇: <i class="fas fa-angle-right"></i>
        <div class="title-text">vscode同步插件配置</div>
      </div>
      <!-- <div class="content">
        1、在vscode上安装sync2、GitHub上注册并登陆账号在登陆页面的右上角点击个人信息后找到设置按钮：3、添加t
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-show="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-show="visible">
      <div class="donate-box_close">
        <i class="fas fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          你的赏识是我前进的动力
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          支付宝
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          微信
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-show="tabActive === 'Alipay'">
          <img src="/medias/zfb.png" class="lazyload placeholder" data-srcset="/medias/zfb.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="支付宝打赏" />
        </div> 
        <div class="WeChatpayImg" v-show="tabActive === 'WeChatpay'">
          <img src="/medias/wx.png" class="lazyload placeholder" data-srcset="/medias/wx.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="微信打赏" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- 文章详情页的分享 -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
      
<section id="comments" style="padding: 1em;"
	class="animated bounceInUp">
	<div id="vcomment" class="comment"></div>
</section>
<style>
	#comments {
		background: rgba(255,255,255,0.9);
	}
	#veditor {
		background-image: url('https://img.zcool.cn/community/01a253594c71cfa8012193a329a77f.gif');
		background-size: contain;
		background-repeat: no-repeat;
		background-position: right;
		background-color: rgba(255, 255, 255, 0);
		resize: vertical;
	}
	#veditor:focus{
		background-position-y: 200px;
		transition: all 0.2s ease-in-out 0s;
	}
	#vcomment .vcards .vcard .vh .vhead .vtag.vvisitor {
		background-color: #42b983;
	}
	.v[data-class=v] .vbtn:active, .v[data-class=v] .vbtn:hover {
		color: #42b983;
		border-color: #42b983;
	}
	#vcomment .vcards .vcard .vhead .vsys i {
		display: none;
	}
	/* 底部valine链接 */
	#vcomment .vpower {
		display: none;
	}
	
	/* 底下注释是修改 名称和邮箱和网址输入框的样式 */
	/* #vcomment .vheader {
		display: flex;
		justify-content: space-around;
	}
	
	#vcomment .vheader .vnick {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vmail {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vlink {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	} */

	img.vimg {
		transition: all 1s;
		/* 头像旋转时间为 1s */
	}

	img.vimg:hover {
		transform: rotate(360deg);
		-webkit-transform: rotate(360deg);
		-moz-transform: rotate(360deg);
		-o-transform: rotate(360deg);
		-ms-transform: rotate(360deg);
	}

	#vcomment .vcards .vcard {
		padding: 15px 20px 0 20px;
		border-radius: 10px;
		margin-bottom: 15px;
		box-shadow: 0 0 4px 1px rgba(0, 0, 0, .12);
		transition: all .3s
	}

	#vcomment .vcards .vcard:hover {
		box-shadow: 0 0 8px 3px rgba(0, 0, 0, .12)
	}

	#vcomment .vcards .vcard .vh .vcard {
		border: none;
		box-shadow: none;
	}
</style>
    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- 目录 -->
  
<aside id='l_side'>
  
    
      
        <section class="widget side_blogger">
  <div class='content'>
    
      
        <a class='avatar flat-box rectangle' href='/about/'>
          <img src='http://api.btstu.cn/sjtx/api.php?lx=c1&format=images'/>
        </a>
      
    
    
      <div class='text'>
        
          <h2>GISER</h2>
        
        
          <p>GUI</p>

        
        
          <p><span id="jinrishici-sentence">GIS技术部门</span></p>
          <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml"
              class="social fas fa-rss flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
              
            </a>
          
        
          
            <a href="mailto:super.gui@qq.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
              
            </a>
          
        
      </div>
    
  </div>
</section>

      
    
  
  
  

  <div class="layout_sticky">    
    
      
<section class="widget side_toc">
  
  <header>
    
      <i style="color: " class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


  <div class='content'>
    <div class="toc-main">
      <div class="toc-content">
        <!-- <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#cesium-%E5%9D%90%E6%A0%87%E7%AE%80%E8%BF%B0"><span class="toc-text">cesium 坐标简述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%B8%B8%E7%94%A8%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2API"><span class="toc-text">1、常用坐标转换API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%AC%9B%E5%8D%A1%E5%B0%94%E5%9D%90%E6%A0%87%E7%B3%BBapi"><span class="toc-text">2、笛卡尔坐标系api</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cesium-%E4%BB%A3%E7%A0%81%E5%BA%94%E7%94%A8"><span class="toc-text">cesium 代码应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%8E%B7%E5%8F%96%E4%B8%89%E4%BD%8D%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E7%9B%B8%E6%9C%BA%E4%BD%8D%E7%BD%AE"><span class="toc-text">1、获取三位场景下的相机位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%9C%B0%E5%9B%BE%E5%B7%A6%E9%94%AE%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="toc-text">2、地图左键点击事件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%A7%BB%E9%99%A4%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6"><span class="toc-text">1.移除鼠标事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.事件类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%AE%BE%E7%BD%AE%E5%9C%B0%E5%9B%BE%E8%A7%86%E8%A7%92"><span class="toc-text">3、设置地图视角</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%9A%84%E6%9D%90%E8%B4%A8%E6%A0%B7%E5%BC%8F"><span class="toc-text">4、创建线的材质样式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%AE%9E%E7%BA%BF%E5%92%8C%E8%99%9A%E7%BA%BF"><span class="toc-text">5、实线和虚线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81cesium%E7%94%BB%E8%B4%B4%E5%9C%B0%E7%BA%BF"><span class="toc-text">6、cesium画贴地线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E5%9C%86%E5%BD%A2%E5%8C%BA%E5%9F%9F%E9%97%AA%E7%83%81"><span class="toc-text">7、圆形区域闪烁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%8D%8A%E5%9C%86%E6%8A%A5%E8%AD%A6%E6%89%AB%E6%8F%8F"><span class="toc-text">8、半圆报警扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E8%8E%B7%E5%8F%96%E7%82%B9%E5%87%BB%E5%9C%B0%E5%9B%BE%E5%90%8E%E7%9A%84%E7%BB%8F%E7%BA%AC%E5%BA%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">9、获取点击地图后的经纬度信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E5%9C%B0%E5%9B%BE%E8%A7%86%E8%A7%92%E9%A3%9E%E5%85%A5%EF%BC%8C%E8%B0%83%E6%95%B4%E5%9C%B0%E5%9B%BE%E8%A7%86%E8%A7%92"><span class="toc-text">10、地图视角飞入，调整地图视角</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81%E5%9C%B0%E5%9B%BE%E7%9A%84%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8%E4%BA%8B%E4%BB%B6"><span class="toc-text">11、地图的鼠标移动事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E3%80%81%E8%AE%BE%E7%BD%AE%E5%9C%B0%E5%9B%BE%E6%B3%9B%E5%85%89%E6%95%88%E6%9E%9C"><span class="toc-text">12、设置地图泛光效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13%E3%80%81cesium%E7%9A%84%E5%9C%B0%E5%9B%BE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">13、cesium的地图初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14%E3%80%81%E8%AE%BE%E7%BD%AE%E5%A2%99%E5%90%91%E4%B8%8A%E7%9A%84%E6%B5%81%E5%8A%A8%E6%95%88%E6%9E%9C"><span class="toc-text">14、设置墙向上的流动效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15%E3%80%81%E6%B7%BB%E5%8A%A0%E7%82%B9%E5%9B%BE%E5%B1%82"><span class="toc-text">15、添加点图层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Entity-%E6%B7%BB%E5%8A%A0%E7%82%B9%E5%9B%BE%E5%B1%82"><span class="toc-text">1、Entity 添加点图层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Primitives-%E6%B7%BB%E5%8A%A0%E7%82%B9%E5%9B%BE%E5%B1%82"><span class="toc-text">2、Primitives 添加点图层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16%E3%80%81Entity-%E6%B7%BB%E5%8A%A0%E7%BA%BF%E5%9B%BE%E5%B1%82"><span class="toc-text">16、Entity 添加线图层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17%E3%80%81cesium%E4%BF%A1%E6%81%AF%E6%A1%86%E5%8A%A8%E6%80%81%E6%98%BE%E7%A4%BA%E5%B9%B6%E8%B7%9F%E9%9A%8F%E7%A7%BB%E5%8A%A8%EF%BC%88%E9%AB%98%E5%BA%A6%E4%BC%9A%E5%BD%B1%E5%93%8D%E5%AE%9A%E4%BD%8D%E7%B2%BE%E5%BA%A6%EF%BC%89"><span class="toc-text">17、cesium信息框动态显示并跟随移动（高度会影响定位精度）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18%E3%80%81%E7%9B%B8%E6%9C%BA%E7%9B%91%E5%90%AC%E3%80%81%E8%8E%B7%E5%8F%96%E4%B8%AD%E5%BF%83%E7%82%B9%E5%9D%90%E6%A0%87%E3%80%81%E9%AB%98%E5%BA%A6%E3%80%81%E5%BD%93%E5%89%8D%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E8%8C%83%E5%9B%B4"><span class="toc-text">18、相机监听、获取中心点坐标、高度、当前可视区域范围</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19%E3%80%81%E5%9C%B0%E5%9B%BE%E6%94%BE%E5%A4%A7%E7%BC%A9%E5%B0%8F%E3%80%81%E7%BB%8F%E7%BA%AC%E5%BA%A6%E6%98%BE%E7%A4%BA"><span class="toc-text">19、地图放大缩小、经纬度显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20%E3%80%81RGBA-%E6%96%B9%E6%B3%95"><span class="toc-text">20、RGBA  方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21%E3%80%81CESIUM-%E6%A8%A1%E5%9E%8B%E5%8A%A0%E8%BD%BD"><span class="toc-text">21、CESIUM   模型加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22%E3%80%81cesiumJI%E5%8A%A0%E8%BD%BD%E6%B0%B4%EF%BC%88%E5%A4%9A%E9%9D%A2%E7%8E%AF%E5%BD%A2%EF%BC%89"><span class="toc-text">22、cesiumJI加载水（多面环形）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23%E3%80%81%E7%BB%8F%E7%BA%AC%E5%BA%A6-lt-gt-%E7%93%A6%E7%89%87%E7%BC%96%E5%8F%B7"><span class="toc-text">23、经纬度&lt;&#x3D;&gt;瓦片编号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24%E3%80%81cesium%E9%99%90%E5%88%B6%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8Fzoom%E7%AD%89%E7%BA%A7%E9%AB%98%E5%BA%A6"><span class="toc-text">24、cesium限制最大最小zoom等级高度</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cesium-%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-text">cesium 插件使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%9C%B0%E5%9B%BE%E6%8E%A7%E4%BB%B6%E6%B7%BB%E5%8A%A0%EF%BC%88%E6%AF%94%E5%88%97%E5%B0%BA%E3%80%81%E6%8C%87%E5%8C%97%E9%92%88%E7%AD%89%EF%BC%89"><span class="toc-text">1、地图控件添加（比列尺、指北针等）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81cesium-%E7%9A%84%E6%B5%8B%E9%87%8F%E9%9D%A2%E6%9D%BF%E6%8F%92%E4%BB%B6%EF%BC%88%E6%B5%8B%E8%B7%9D%E3%80%81%E6%B5%8B%E9%9D%A2%E3%80%81%EF%BC%89"><span class="toc-text">2、cesium 的测量面板插件（测距、测面、）</span></a></li></ol></li></ol> -->
        <div class="toc"></div>
      </div>
    </div>
  </div>
</section>
<!-- 手机端目录按钮 -->
<div id="toc-mobile-btn">
  <i class="fas fa-list-ul" aria-hidden="true"></i>
</div>

      
  <section class="widget side_recent_post">
    
  <header>
    
      <a style="color: " href='/tags/'><i class="fas fa-book fa-fw" aria-hidden="true"></i><span class='name'>最新文章</span></a>
    
  </header>


    <div class='content'>
      
      <!-- hash算法 -->
      
      <div class="aside-list">
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2022/12/21/%E4%BA%8B%E4%BB%B6/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="/medias/8.jpg" class="lazyload placeholder" data-srcset="/medias/8.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">12-21</span>
                
              </div>
              <a class="post-title" href="/2022/12/21/%E4%BA%8B%E4%BB%B6/">cesium pick和射线的使用（工具篇）</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2021/10/12/%E5%9D%90%E6%A0%87%E7%B3%BB%E7%9A%84%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="/medias/2.jpg" class="lazyload placeholder" data-srcset="/medias/2.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">10-12</span>
                
              </div>
              <a class="post-title" href="/2021/10/12/%E5%9D%90%E6%A0%87%E7%B3%BB%E7%9A%84%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83/">坐标系命名规范</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2021/09/29/%E5%8C%BA%E5%88%ABclientX%E3%80%81offsetX%E3%80%81screenX%E3%80%81pageX/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="/medias/5.jpg" class="lazyload placeholder" data-srcset="/medias/5.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">09-29</span>
                
              </div>
              <a class="post-title" href="/2021/09/29/%E5%8C%BA%E5%88%ABclientX%E3%80%81offsetX%E3%80%81screenX%E3%80%81pageX/">区别了 clientX、offsetX、screenX、pageX等</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2021/09/29/Zerotier%20Moon%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="/medias/7.jpg" class="lazyload placeholder" data-srcset="/medias/7.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">09-29</span>
                
              </div>
              <a class="post-title" href="/2021/09/29/Zerotier%20Moon%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/">安装 zerotier-one</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2021/09/14/cesium%E6%B3%9B%E5%85%89%E5%BB%BA%E7%AD%91/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="/medias/8.jpg" class="lazyload placeholder" data-srcset="/medias/8.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">09-14</span>
                
              </div>
              <a class="post-title" href="/2021/09/14/cesium%E6%B3%9B%E5%85%89%E5%BB%BA%E7%AD%91/">cesium 建筑泛光动效</a>
            </div>
          </div>
        
      </div>
    </div>
  </section>

    
  </div>
</aside>


  <!-- 图片放大 Wrap images with fancybox support -->
  <script src="/js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://unpkg.com/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- 页脚 -->
    
  
  
    <!-- 底部鱼儿跳动效果，依赖于jquery-->
<div id="j-fish-skip" style=" position: relative;height: 153px;width: auto;"></div>
<script>
  var RENDERER = {
    POINT_INTERVAL: 5,
    FISH_COUNT: 3,
    MAX_INTERVAL_COUNT: 50,
    INIT_HEIGHT_RATE: .5,
    THRESHOLD: 50,
    FISH_COLOR: '',
    init: function () {
      this.setFishColor(); this.setParameters(), this.reconstructMethods(), this.setup(), this.bindEvent(), this.render()
    },
    setFishColor: function () {
      let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
      if (isDark) {
        this.FISH_COLOR = '#222'; // 暗黑色，有时间把这整成一个变量
      } else {
        this.FISH_COLOR = '' || '#42b983';
      }
    },
    setParameters: function () {
      this.$window = $(window), this.$container = $("#j-fish-skip"), this.$canvas = $("<canvas />"), this.context = this.$canvas.appendTo(this.$container).get(0).getContext("2d"), this.points = [], this.fishes = [], this.watchIds = []
    },
    createSurfacePoints: function () {
      var t = Math.round(this.width / this.POINT_INTERVAL);
      this.pointInterval = this.width / (t - 1), this.points.push(new SURFACE_POINT(this, 0));
      for (var i = 1; i < t; i++) {
        var e = new SURFACE_POINT(this, i * this.pointInterval),
          h = this.points[i - 1];
        e.setPreviousPoint(h), h.setNextPoint(e), this.points.push(e)
      }
    },
    reconstructMethods: function () {
      this.watchWindowSize = this.watchWindowSize.bind(this), this.jdugeToStopResize = this.jdugeToStopResize.bind(this), this.startEpicenter = this.startEpicenter.bind(this), this.moveEpicenter = this.moveEpicenter.bind(this), this.reverseVertical = this.reverseVertical.bind(this), this.render = this.render.bind(this)
    },
    setup: function () {
      this.points.length = 0, this.fishes.length = 0, this.watchIds.length = 0, this.intervalCount = this.MAX_INTERVAL_COUNT, this.width = this.$container.width(), this.height = this.$container.height(), this.fishCount = this.FISH_COUNT * this.width / 500 * this.height / 500, this.$canvas.attr({
        width: this.width,
        height: this.height
      }), this.reverse = !1, this.fishes.push(new FISH(this)), this.createSurfacePoints()
    },
    watchWindowSize: function () {
      this.clearTimer(), this.tmpWidth = this.$window.width(), this.tmpHeight = this.$window.height(), this.watchIds.push(setTimeout(this.jdugeToStopResize, this.WATCH_INTERVAL))
    },
    clearTimer: function () {
      for (; this.watchIds.length > 0;) clearTimeout(this.watchIds.pop())
    },
    jdugeToStopResize: function () {
      var t = this.$window.width(),
        i = this.$window.height(),
        e = t == this.tmpWidth && i == this.tmpHeight;
      this.tmpWidth = t, this.tmpHeight = i, e && this.setup()
    },
    bindEvent: function () {
      this.$window.on("resize", this.watchWindowSize), this.$container.on("mouseenter", this.startEpicenter), this.$container.on("mousemove", this.moveEpicenter)
    },
    getAxis: function (t) {
      var i = this.$container.offset();
      return {
        x: t.clientX - i.left + this.$window.scrollLeft(),
        y: t.clientY - i.top + this.$window.scrollTop()
      }
    },
    startEpicenter: function (t) {
      this.axis = this.getAxis(t)
    },
    moveEpicenter: function (t) {
      var i = this.getAxis(t);
      this.axis || (this.axis = i), this.generateEpicenter(i.x, i.y, i.y - this.axis.y), this.axis = i
    },
    generateEpicenter: function (t, i, e) {
      if (!(i < this.height / 2 - this.THRESHOLD || i > this.height / 2 + this.THRESHOLD)) {
        var h = Math.round(t / this.pointInterval);
        h < 0 || h >= this.points.length || this.points[h].interfere(i, e)
      }
    },
    reverseVertical: function () {
      this.reverse = !this.reverse;
      for (var t = 0, i = this.fishes.length; t < i; t++) this.fishes[t].reverseVertical()
    },
    controlStatus: function () {
      for (var t = 0, i = this.points.length; t < i; t++) this.points[t].updateSelf();
      for (t = 0, i = this.points.length; t < i; t++) this.points[t].updateNeighbors();
      this.fishes.length < this.fishCount && 0 == --this.intervalCount && (this.intervalCount = this.MAX_INTERVAL_COUNT, this.fishes.push(new FISH(this)))
    },
    render: function () {
      requestAnimationFrame(this.render), this.controlStatus(), this.context.clearRect(0, 0, this.width, this.height), this.context.fillStyle = this.FISH_COLOR;
      for (var t = 0, i = this.fishes.length; t < i; t++) this.fishes[t].render(this.context);
      this.context.save(), this.context.globalCompositeOperation = "xor", this.context.beginPath(), this.context.moveTo(0, this.reverse ? 0 : this.height);
      for (t = 0, i = this.points.length; t < i; t++) this.points[t].render(this.context);
      this.context.lineTo(this.width, this.reverse ? 0 : this.height), this.context.closePath(), this.context.fill(), this.context.restore()
    }
  },
  SURFACE_POINT = function (t, i) {
    this.renderer = t, this.x = i, this.init()
  };
  SURFACE_POINT.prototype = {
    SPRING_CONSTANT: .03,
    SPRING_FRICTION: .9,
    WAVE_SPREAD: .3,
    ACCELARATION_RATE: .01,
    init: function () {
      this.initHeight = this.renderer.height * this.renderer.INIT_HEIGHT_RATE, this.height = this.initHeight, this.fy = 0, this.force = {
        previous: 0,
        next: 0
      }
    },
    setPreviousPoint: function (t) {
      this.previous = t
    },
    setNextPoint: function (t) {
      this.next = t
    },
    interfere: function (t, i) {
      this.fy = this.renderer.height * this.ACCELARATION_RATE * (this.renderer.height - this.height - t >= 0 ? -1 : 1) * Math.abs(i)
    },
    updateSelf: function () {
      this.fy += this.SPRING_CONSTANT * (this.initHeight - this.height), this.fy *= this.SPRING_FRICTION, this.height += this.fy
    },
    updateNeighbors: function () {
      this.previous && (this.force.previous = this.WAVE_SPREAD * (this.height - this.previous.height)), this.next && (this.force.next = this.WAVE_SPREAD * (this.height - this.next.height))
    },
    render: function (t) {
      this.previous && (this.previous.height += this.force.previous, this.previous.fy += this.force.previous), this.next && (this.next.height += this.force.next, this.next.fy += this.force.next), t.lineTo(this.x, this.renderer.height - this.height)
    }
  };
  var FISH = function (t) {
    this.renderer = t, this.init()
  };
  FISH.prototype = {
    GRAVITY: .4,
    init: function () {
      this.direction = Math.random() < .5, this.x = this.direction ? this.renderer.width + this.renderer.THRESHOLD : -this.renderer.THRESHOLD, this.previousY = this.y, this.vx = this.getRandomValue(4, 10) * (this.direction ? -1 : 1), this.renderer.reverse ? (this.y = this.getRandomValue(1 * this.renderer.height / 10, 4 * this.renderer.height / 10), this.vy = this.getRandomValue(2, 5), this.ay = this.getRandomValue(.05, .2)) : (this.y = this.getRandomValue(6 * this.renderer.height / 10, 9 * this.renderer.height / 10), this.vy = this.getRandomValue(-5, -2), this.ay = this.getRandomValue(-.2, -.05)), this.isOut = !1, this.theta = 0, this.phi = 0
    },
    getRandomValue: function (t, i) {
      return t + (i - t) * Math.random()
    },
    reverseVertical: function () {
      this.isOut = !this.isOut, this.ay *= -1
    },
    controlStatus: function (t) {
      this.previousY = this.y, this.x += this.vx, this.y += this.vy, this.vy += this.ay, this.renderer.reverse ? this.y > this.renderer.height * this.renderer.INIT_HEIGHT_RATE ? (this.vy -= this.GRAVITY, this.isOut = !0) : (this.isOut && (this.ay = this.getRandomValue(.05, .2)), this.isOut = !1) : this.y < this.renderer.height * this.renderer.INIT_HEIGHT_RATE ? (this.vy += this.GRAVITY, this.isOut = !0) : (this.isOut && (this.ay = this.getRandomValue(-.2, -.05)), this.isOut = !1), this.isOut || (this.theta += Math.PI / 20, this.theta %= 2 * Math.PI, this.phi += Math.PI / 30, this.phi %= 2 * Math.PI), this.renderer.generateEpicenter(this.x + (this.direction ? -1 : 1) * this.renderer.THRESHOLD, this.y, this.y - this.previousY), (this.vx > 0 && this.x > this.renderer.width + this.renderer.THRESHOLD || this.vx < 0 && this.x < -this.renderer.THRESHOLD) && this.init()
    },
    render: function (t) {
      t.save(), t.translate(this.x, this.y), t.rotate(Math.PI + Math.atan2(this.vy, this.vx)), t.scale(1, this.direction ? 1 : -1), t.beginPath(), t.moveTo(-30, 0), t.bezierCurveTo(-20, 15, 15, 10, 40, 0), t.bezierCurveTo(15, -10, -20, -15, -30, 0), t.fill(), t.save(), t.translate(40, 0), t.scale(.9 + .2 * Math.sin(this.theta), 1), t.beginPath(), t.moveTo(0, 0), t.quadraticCurveTo(5, 10, 20, 8), t.quadraticCurveTo(12, 5, 10, 0), t.quadraticCurveTo(12, -5, 20, -8), t.quadraticCurveTo(5, -10, 0, 0), t.fill(), t.restore(), t.save(), t.translate(-3, 0), t.rotate((Math.PI / 3 + Math.PI / 10 * Math.sin(this.phi)) * (this.renderer.reverse ? -1 : 1)), t.beginPath(), this.renderer.reverse ? (t.moveTo(5, 0), t.bezierCurveTo(10, 10, 10, 30, 0, 40), t.bezierCurveTo(-12, 25, -8, 10, 0, 0)) : (t.moveTo(-5, 0), t.bezierCurveTo(-10, -10, -10, -30, 0, -40), t.bezierCurveTo(12, -25, 8, -10, 0, 0)), t.closePath(), t.fill(), t.restore(), t.restore(), this.controlStatus(t)
    }
  }, $(function () {
    RENDERER.init()
    $('.dark').click(function () {
      setTimeout(() => {
        RENDERER.setFishColor();
        RENDERER.context.fill();
      });
    })
  });
</script>
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright © 2019 - 2020 <a target="_blank" rel="noopener" href="https://github.com/yuang01">yuang01</a> | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a> </p>

          </div>
        
      
        
          
            <!-- 不蒜子统计 -->
            <!-- 不蒜子统计 -->
<span id="busuanzi_container_site_pv">
      <i class="fas fa-eye" aria-hidden="true"></i>本站总访问量：<span id="busuanzi_value_site_pv"></span> 次
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fas fa-users" aria-hidden="true"></i>本站访客数：<span id="busuanzi_value_site_uv"></span> 人
</span>

          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- 渲染暗黑按钮 -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fas fa-moon" aria-hidden="true"></i>
    <!-- <span>关灯</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>

    
    <!-- 渲染左下角音乐播放器 -->
    
      <link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://unpkg.com/meting@2/dist/Meting.min.js"></script>
    

    <!-- 图片放大 -->
    
      <script src="/js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- 背景彩带 -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    

    <script src="/js/utils/index.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- 文章目录所需js -->
<!-- <link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.min.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.css">

<script>
  var headerEl = 'h2, h3, h4',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -70,
    // headingsOffset: -($(window).height() * 0.4 - 45),
    headingsOffset: -($(window).height() * 0.6 - 70),
    // positionFixedSelector: '.toc-main',
    // positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    orderedList: true,
    collapseDepth: 20,
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 150) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('side_toc')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }
</script>

<style>
  /* .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  } */
</style>
 

<!-- 设置导航背景 -->
<script>
  let setHeaderClass = () => {
    const headerMenuTransparent = true;
    if (!headerMenuTransparent) { return; }
    const nav = $('#navHeader');
    const navTop = nav.outerHeight();
    const winTop = $(window).scrollTop();
    if(winTop > navTop) {
      nav.addClass('header-bg-color');
    }
    else {
      nav.removeClass('header-bg-color');
    }
  };

  let scrollCollect = () => {
    return bamboo.throttle(function (e) {
      setHeaderClass();
    }, 200)()
  }

  let initHeaderBg = () => {
    setHeaderClass();
  }

  setHeaderClass();
  window.addEventListener('scroll', scrollCollect);

  document.addEventListener('pjax:send', function () {
    window.removeEventListener('scroll', scrollCollect)
  })
  document.addEventListener('pjax:complete', function () {
    window.addEventListener('scroll', scrollCollect);
    setHeaderClass();
  })
</script> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="https://unpkg.com/v-plugs-ayu/lib/ayu.css">
  <script src="https://unpkg.com/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = '复制';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "成功",
            content: "代码已复制，请遵守相关授权协议。",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- 图片懒加载 -->
<script defer src="https://unpkg.com/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- 卡片滚动动画 -->
   

<!-- 评论所需js -->

  
    <!-- 弹幕所需的css和js -->
    
<!-- 具体js，请前往valine/script.ejs查看 -->

    <script>
  var requiredFields = '';
  requiredFields = requiredFields.split(',');
  comment_el = '.comment';
  let looperValine = null;
  load_valine = function () {
    if ($(comment_el).length) {
      var valine = new Valine({
        el: '#vcomment',
        path: window.location.pathname,
        notify: false,
        verify: false,
        app_id: "CcXapJrmuMu1xAoWycpH2hzt-gzGzoHsz",
        app_key: "devoQ3DWkTXSld7UoTrY0Pxk",
        placeholder: "客官，说点什么吧",
        avatar: "",
        master: "",   //博主邮箱md5
        tagMeta: ["博主","小伙伴","访客"],     //标识字段名
        friends: "",
        metaPlaceholder: { "nick": "昵称/QQ号", "mail": "邮箱" },
        requiredFields: requiredFields,
        enableQQ: true,
      });
      function debounce(fn) {
        var timerID = null
        return function () {
          var arg = arguments[0]   //获取事件
          if (timerID) {
            clearTimeout(timerID)
          }
          timerID = setTimeout(function () {
            fn(arg)              //事件传入函数
          }, 200)
        }
      }
      //查询评论 valine.Q('*').limit(7) -- 查询所有，限制7条, 下面的的代码是查询当前页面
      var themeDanmu = eval('false');
      var themeLoop = eval('false');
      var themeLooperTime = '5000' || 5000;
      var speed = '40' || 20;
      var isBarrager = true;
      if (themeDanmu == true) {
        do_barrager();
        if ($('.danmuBox').length <= 0) {
          $('.navbar').append('<div class="danmuBox"><div class="danmuBtn open"><span class="danmuCircle"></span><span class="danmuText">弹幕</span></div></div>');
        }
        $('.danmuBtn').on('click', debounce(
          function () {
            if ($('.danmuBtn').hasClass('open')) {
              $('.danmuBtn').removeClass('open')
              clearInterval(looperValine);
              $.fn.barrager.removeAll();
            } else {
              $('.danmuBtn').addClass("open");
              do_barrager();
            }
          }
        ))
      }
      function do_barrager() {
        isBarrager && valine.Q(window.location.pathname).find().then(function (comments) {
          // var num = 0; // 可以记录条数，循环调用的时候只取最新的评论放入弹幕中
          var run_once = true;
          var looper_time = themeLooperTime;
          var total = comments.length;
          // var looper = null;
          var index = 0;
          if (total > 0) {
            barrager();
          } else {
            // 当评论数为0的时候，自动关闭弹幕
            // $('.danmuBtn').removeClass('open');
          }
          function barrager() {
            if (run_once) {
              //如果是首次执行,则设置一个定时器,并且把首次执行置为false
              looperValine = setInterval(barrager, looper_time);
              run_once = false;
            }
            var content = comments[index]._serverData.comment;
            var email = comments[index]._serverData.mail;
            var link = comments[index]._serverData.link;
            var newcontent = content.substring(0, 50).replace(/<[^>]+>/g, "");
            //发布一个弹幕
            const item = {
              img: `https://q1.qlogo.cn/g?b=qq&nk=${email}&s=640`, //图片 
              info: newcontent, //文字 
              href: link, //链接 
              close: true, //显示关闭按钮 
              speed: speed, //延迟,单位秒,默认6 
              color: '#fff', //颜色,默认白色 
              old_ie_color: '#000000', //ie低版兼容色,不能与网页背景相同,默认黑色
            }
            $('body').barrager(item);
            //索引自增
            index++;
            //所有弹幕发布完毕，清除计时器。
            if (index == total) {
              clearInterval(looperValine);
              if (themeLoop === true) {
                setTimeout(function () {
                  do_barrager();
                }, 5000);
              } else {
                $('.danmuBtn').removeClass('open');
              }
              return false;
            }

          }
        })
      }
    }
  };
  $(document).ready(load_valine);
  document.addEventListener('pjax:send', function (e) {
    
  })
  document.addEventListener('pjax:complete', function () {
    load_valine();
  });
</script>

  


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

  
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 999; pointer-events: none;" ></canvas>
    <script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script src="/js/cursor/explosion.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


<!-- 轮播图标签 -->
<script>
  var bambooSwiperTag = {};
  function load_swiper() {
    if (!document.querySelectorAll(".post-swiper-container")[0]) return;
    loadCSS("https://unpkg.com/swiper@6/swiper-bundle.min.css")
    loadScript("https://unpkg.com/swiper@6/swiper-bundle.min.js").then(() => {
      pjax_swiper();
    });
  }

  load_swiper();

  function pjax_swiper() {
    bambooSwiperTag.swiper = new Swiper('.post-swiper-container', {
      slidesPerView: 'auto',
      spaceBetween: 8,
      centeredSlides: true,
      loop: true,
      autoplay: true ? {
        delay: 3000,
        stopOnLastSlide: false,
        disableOnInteraction: false,
      } : false,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
      on:{
        init: function(){
          swiperAnimateCache(this); //隐藏动画元素 
          swiperAnimate(this); //初始化完成开始动画
        }, 
        slideChangeTransitionEnd: function(){ 
          swiperAnimate(this); //每个slide切换结束时也运行当前slide动画
          //this.slides.eq(this.activeIndex).find('.ani').removeClass('ani'); 动画只展现一次，去除ani类名
        } 
      }
    });
  }

  document.addEventListener('pjax:complete', function () {
    if (!document.querySelectorAll(".post-swiper-container")[0]) return;
    if (typeof bambooSwiperTag.swiper === "undefined") {
      load_swiper();
    } else {
      pjax_swiper();
    }
  });
</script>
    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>